<html>
<head>
  <title>09 IMX6ULL裸机开发：UART串口简介及寄存器介绍</title>
  <basefont face="微软雅黑" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="YXBJ Windows/605138 (zh-CN, DDL); Windows/10.0.0 (Win64); EDAMVersion=V2;"/>
  <meta name="content-class" content="yinxiang.superNote"/>
  <style>
    body, td {
      font-family: 微软雅黑;
      font-size: 12pt;
    }
  </style>
</head>
<body>
<a name="778"/>
<h1>09 IMX6ULL裸机开发：UART串口简介及寄存器介绍</h1>
<div>
<table bgcolor="#D4DDE5" border="0">
<tr><td><b>创建时间：</b></td><td><i>2022/1/12 14:36</i></td></tr>
<tr><td><b>更新时间：</b></td><td><i>2022/1/17 10:04</i></td></tr>
<tr><td><b>作者：</b></td><td><i>gi51wa2j</i></td></tr>
<tr><td><b>标签：</b></td><td><i>100ask_IMX6ULL_v11, bingo, 正文</i></td></tr>
</table>
</div>
<br/>

<div><span><h1>一、UART介绍</h1><h2><b>1.1 UART串口简介</b></h2><div><b> </b>    <b>UART全称是通用异步收发传输器（Universal Asynchronous  Receiver/Transmitter)，简称串口。</b><span style="color: #FF0000;"><b>串口</b></span>顾名思义是数据串行接口，即数据的传输是一位接一位传输，属于一种串行的数据总线，属于<span style="background-color: #ffff00;">异步通讯</span>，同时支持全双工数据传输（<span style="background-color: #ffff00;">全双工数据传输：允许发送数据和接收数据在同一时刻发生</span>）。</div><div><b> </b>    <b>除了UART，另外还有一种叫USART，全称是通用同步/异步串行接收/发送器(Universal  Synchronous/Asynchronous Receiver/Transmitter)</b>，USART比 UART多了同步通信功能<span style="background-color: #ffff00;">，但是百分之90的工程应用中不会应用该同步功能，都是将USART当做UART使用，即采取异步串行通讯。</span>一般开发板或者产品中都会将UART串口标为serial或COM。</div><div>一般做调试信息发送或者外接各种模块</div><h3> 1.1.1 串口电平</h3><div>ARM芯片上得串口都是TTL电平的，通过板子上或者外接的电平转换芯片，转成RS232接口，连接到电脑的RS232串口上，实现两者的数据传输。</div><img src="09 IMX6ULL裸机开发：UART串口简介及寄存器介绍_files/Image.png" type="image/png" data-filename="Image.png" style="--en-uploadstate:uploaded;" width="535.5533498759305px"/><div>现在的电脑越来越少有RS232串口的接口，当USB是几乎都有的。因此使用USB串口芯片将ARM芯片上的TTL电平转换成USB串口协议，即可通过USB与电脑数据传输。</div><img src="09 IMX6ULL裸机开发：UART串口简介及寄存器介绍_files/Image [1].png" type="image/png" data-filename="Image.png" style="--en-uploadstate:uploaded;" width="514px"/><div>上面的两种方式，对ARM芯片的编程操作都是一样的。</div><h3>1.1.2 串口内部框架</h3><ul><li><div>JZ2440</div></li></ul><div>ARM芯片是如何发送/接收数据？</div><p>如图所示串口结构图（<span style="color: #FF0000;">以jz2440为例，此处仅供参考</span>）：</p><img src="09 IMX6ULL裸机开发：UART串口简介及寄存器介绍_files/lesson1_007.bmp" type="image/bmp" data-filename="lesson1_007.bmp" style="--en-uploadstate:uploaded;" width="630.5222929936306px"/><div>     要发送数据时，CPU控制内存要发送的数据通过FIFO传给UART单位，UART里面的移位器，依次将数据发送出去，在发送完成后产生中断提醒CPU传输完成。</div><p>     接收数据时，获取接收引脚的电平，逐位放进接收移位器，再放入FIFO，写入内存。在接收完成后产生中断提醒CPU传输完成。</p><ul><li><p>IMX6ULL（）</p></li></ul><p><span style="background-color: #ffffff;"><span style="font-weight: 400;"> </span></span>    <span style="background-color: #ffffff;"><span style="font-weight: 400;">参考手册IMX6ULLRM.pdf中《CChapter 55: Universal Asynchronous Receiver/Transmitter (UART)》各类芯片的UART框图都是类似的，当设置好UART后，程序读写数据寄存器就可以接收、发送数据了。</span></span></p><img src="09 IMX6ULL裸机开发：UART串口简介及寄存器介绍_files/001_imx6ull_uart_block_diagram-1642164776092.png" type="image/png" data-filename="001_imx6ull_uart_block_diagram-1642164776092.png" style="--en-uploadstate:uploaded;"/><h2><b>1.2 UART硬件连接</b></h2><h3>1.2.1 TTL电平三线连接</h3><div><span style="background-color: #ffff00;"><b>UART串口最精简的连接是TTL电平三线连接</b></span></div><div>     UARTx_TXD：用于发送数据，应连接到接收设备的UARTx_RXD引脚上；</div><div>     UARTx_RXD：用于接收数据，应连接到发送设备的UARTx_TXD引脚上；</div><div style="padding-left:40px;">   GND：为双方提供一个相同的参考电平。</div><img src="09 IMX6ULL裸机开发：UART串口简介及寄存器介绍_files/Image [2].png" type="image/png" data-filename="Image.png" style="--en-uploadstate:uploaded;" width="824px"/><div><br/></div><div>     上图为UART串口TTL电平硬件连接，此时使用标准的TTL电平来表示数据，高电平表示1，低电平表示0，<span style="background-color: #ffff00;">标准TTL输入高电平最小2V，输出高电平最小2.4V，典型值为3.4V，输入低电平最大0.8V，输出低电平最大0.4V，典型值为0.2V。</span></div><div>     <span style="color: #FF0000;">直接采用TTL电平进行串行通讯，由于其抗干扰能力差，导致传输距离短，且容易出现数据不可靠的情况。</span></div><div>     为提高抗干扰能力和传输距离，一般采用下面两种硬件连接方式。</div><h3><b>1.2.2 TTL电平转RS232电平</b></h3><div>硬件连接如下图：</div><img src="09 IMX6ULL裸机开发：UART串口简介及寄存器介绍_files/Image [3].png" type="image/png" data-filename="Image.png" style="--en-uploadstate:uploaded;" width="825px"/><div><br/></div><div>     RS232电平规定逻辑“1”的电平为-5V~-15 V，逻辑“0”的电平为+5 V～+15 V，选用该电气标准以提高抗干扰能力。常用的TTL转RS232芯片有：<span style="background-color: #ffff00;">MAX232，SP3232</span>等。</div><h3><b>1.2.3 TTL电平转USB电平</b></h3><img src="09 IMX6ULL裸机开发：UART串口简介及寄存器介绍_files/Image [4].png" type="image/png" data-filename="Image.png" style="--en-uploadstate:uploaded;" width="822px"/><div>     将TTL电平转换为USB电平（D+与D-一对差分信号采用NRZI编码实现通讯），提高抗干扰能力，常用的TTL转USB芯片有：<span style="background-color: #ffff00;">PL2303，CH340, CP2102</span>等</div><div><b> </b>    <b>100ASK_IMX6ULL采用的是上述方案中的“TTL转USB方案”。</b></div><h2><b>1.3 UART通讯数据格式</b></h2><div>    <span style="background-color: #ffff00;">URT之间为何能够准确可靠的的发送和接收数据？</span></div><div>首先我们需要约定好传输速率（每一秒传输的数据位数，即波特率），一般选择9600,19200,115200等。</div><div>    <span style="background-color: #ffff00;">确定好传输速率后，我们还需要确定传输数据的格式</span>，UART串口通信的数据包以帧为单位，<b>常用的帧结构为：1位起始位+8位数据位+1位奇偶校验位（可选）+1位停止位。</b></div><div>举例说明，如下图：</div><img src="09 IMX6ULL裸机开发：UART串口简介及寄存器介绍_files/Image [5].png" type="image/png" data-filename="Image.png" style="--en-uploadstate:uploaded;" width="822px"/><div><br/></div><div>     上图为：1位起始位+8位数据位+1位偶校验位+1位停止位 的波形。</div><div><b> </b>    <b>根据查找ASCII码表得知’ A’字符的ASCII值为41（十六进制），将其转换成二进制应该为0100 0001，小端传输（从后向前传），即低位（LSB）在前，高位（MSB）在后，和上图所示一致。</b></div><div>上图中各位的详细说明如下：</div><h3><b>1.3.1 空闲位:</b></h3><div>     平没有数据时，数据线为高电平（逻辑1）；</div><h3><b>1.3.2 起始位:</b></h3><div>     当需要发送数据时，UART将改变UARTx_TXD的状态，变为低电平，即为上图中的起始位（逻辑0），表示传输数据的开始。</div><h3><b>1.3.3 数据位:</b></h3><div>     可以有5、6、7或8位的数据，一般我们是按字节（8位）传输数据，发送方一位一位的改变数据线上的状态（高电平或低电平）将它们发送出去，<span style="color: #FF0000;"><b>传输数据时先传最低位，最后传送最高位。</b></span></div><div>字符’A’的8位二进制字符是0100 0001，先发送最低位bit 0，其值为1；再发送bit  1，其值为0，如此继续；最后发送最高位bit 7，其值为0。</div><h3><b>1.3.4 奇偶校验位</b></h3><div>     如果使用了奇偶校验功能，有效数据位发送完毕后，还要发送1个校验位（奇偶校验位）。</div><div>有两种校验方法：<span style="color: #FF0000;">奇校验，偶校验</span>-------数据位连同校验位中，“1”的数目等于奇数或偶数。<span style="color: #FF0000;">奇偶校验只能检错，不能纠错的</span>。而且只能检测1位误码，检测出有错后只能要求重发，没法纠正的。</div><div>上图中使用的是偶较验，即8个数据位和1个校验位中，一共有偶数个“1”：2个。</div><h3><b>1.3.5 停止位</b></h3><div>     停止位（逻辑1）用来表示当前数据传输完毕。</div><div>停止位的长度有三种：1位，1.5位，2位，通常我们选择1位即可。</div><h1>二、IMX6ULL UART寄存器介绍</h1><div>     UART:Universal Asynchronous Receiver/Transmitter，通用异步收发传输器。</div><div><b> </b>   <span style="color: #FF0000;"> <b>参考资料</b>：</span>网盘开发板配套资料<b>“06_Datasheet（数据手册）/Core_board/CPU/IMX6ULLRM.pdf”中《CChapter 55: Universal Asynchronous  Receiver/Transmitter (UART)》</b>。 </div><h2><b>2.1 IMX6ULL UART模块简介</b></h2><div><span style="background-color: #ffff00;">IMX6ULL共8个独立的UART通道，即8个UART，主要特性如下：</span></div><div style="padding-left:80px;">a.兼容高速串口标准TIA/EIA-232-F，高达5Mbit/s；</div><div style="padding-left:80px;">b.低速串行红外接口（IR），兼容Ir-DA（速度高达115.2Kbit/s）；</div><div style="padding-left:80px;">c.支持9位或多点模式（RS-485）（自动从机地址检测）；</div><div style="padding-left:80px;">d.1或2位停止位；</div><div style="padding-left:80px;">e.可编程奇偶校验（偶校验，奇校验，不校验）；</div><div style="padding-left:80px;">f.自动波特率检测（最高支持115.2Kbit/s）；</div><div style="padding-left:80px;">g.可屏蔽中断</div><div style="padding-left:80px;">h.软复位（SRST_B）</div><div>以上只是列举了部分常用的特性，如需要更加详细的了解需要查看芯片手册《Chapter 55  Universal Asynchronous Receiver/Transmitter(UART)》。</div><div>对于ARM开发，一般使用串口1做调试打印，其它做输出</div><h2><b>2.2 IMX6ULL UART寄存器简介</b></h2><div><b> </b>    <b>IMX6ULL 8路UART通道，每一路通道都有17个寄存器</b>，掌握其中一路通道，其他通道都是照葫芦画瓢，只是基地址、IO复用的管脚不同。</div><div>     UART1的寄存器如下图：</div><img src="09 IMX6ULL裸机开发：UART串口简介及寄存器介绍_files/Image [6].png" type="image/png" data-filename="Image.png" style="--en-uploadstate:uploaded;" width="667px"/><div>而我们本次实验使用到的只有上面红色框框9项。</div><h3><span style="background-color: #ffff00;">2.2.1 UART1_URXD</span></h3><div>     主要用于接收串口数据的寄存器，只有低八位的空间是存储接收数据的，其他是一些判断位，基本用不上；有数据时，读取这个寄存器就可以得到数据。</div><img src="09 IMX6ULL裸机开发：UART串口简介及寄存器介绍_files/Image [7].png" type="image/png" data-filename="Image.png" style="--en-uploadstate:uploaded;" width="688px"/><div><br/></div><h3><span style="background-color: #ffff00;">2.2.2 UART1_UTXD</span></h3><div>     用于发送串口数据的寄存器，只有低八位的空间用于发送数据，其他位保留不使用；要发送数据时，写入这个寄存器就可以了。</div><img src="09 IMX6ULL裸机开发：UART串口简介及寄存器介绍_files/Image [8].png" type="image/png" data-filename="Image.png" style="--en-uploadstate:uploaded;" width="700px"/><div><br/></div><h3><span style="background-color: #ffff00;">2.2.3 UART1_UCR1</span></h3><div>     控制寄存器1，用于设置串口各类功能的使能，例如自动波特率检测的使能，发送中断，串口DMA使能，串口使能等。而我们本章节只使用bit0，串口使能即可。</div><img src="09 IMX6ULL裸机开发：UART串口简介及寄存器介绍_files/Image [9].png" type="image/png" data-filename="Image.png" style="--en-uploadstate:uploaded;" width="828px"/><div><br/></div><h3><span style="background-color: #ffff00;">2.2.4 UART1_UCR2 </span></h3><div>     控制寄存器2：主要用于设置串口的发送帧格式，帧长，是否奇偶校验，是否忽略有RTS，软复位等，本章只使用其中的5位，后续UART编程会详细讲解。</div><img src="09 IMX6ULL裸机开发：UART串口简介及寄存器介绍_files/Image [10].png" type="image/png" data-filename="Image.png" style="--en-uploadstate:uploaded;" width="773px"/><h3><span style="background-color: #ffff00;">2.2.5 UART1_UCR3</span></h3><div style="--en-callout:true;"><div>芯片特点</div></div><div>     控制寄存器3：我们只设置bit2，官方要求设置，属于芯片特点。</div><img src="09 IMX6ULL裸机开发：UART串口简介及寄存器介绍_files/Image [11].png" type="image/png" data-filename="Image.png" style="--en-uploadstate:uploaded;" width="810px"/><h3><span style="background-color: #ffff00;">2.2.6 UART1_UFCR</span></h3><div>     串口FIFO控制寄存器，设置发送与接收的fifo的大小，最大32字节，串口时钟分频系数等，只要把RFDIV此位设置为不分频，其他用默认值即可，更详细使用会在后面的UART编程中讲解。</div><div><a href="https://blog.csdn.net/qq_38721302/article/details/83089305?utm_medium=distribute.pc_relevant.none-task-blog-2~default~baidujs_baidulandingword~default-0.pc_relevant_paycolumn_v2&amp;spm=1001.2101.3001.4242.1&amp;utm_relevant_index=3" rev="en_rl_none">FIFO理解</a></div><div><br/></div><img src="09 IMX6ULL裸机开发：UART串口简介及寄存器介绍_files/Image [12].png" type="image/png" data-filename="Image.png" style="--en-uploadstate:uploaded;" width="827px"/><div><br/></div><h3><span style="background-color: #ffff00;">2.2.7 UART1_USR2</span></h3><div>     串口状态寄存器，该寄存器里面主要是一些串口的状态位，我们本章只使用了TXDC发送完成位与ROR接收数据就绪位。详细使用会在后面UART编程中讲解</div><img src="09 IMX6ULL裸机开发：UART串口简介及寄存器介绍_files/Image [13].png" type="image/png" data-filename="Image.png" style="--en-uploadstate:uploaded;" width="692px"/><h3><span style="background-color: #ffff00;">2.2.8 UART1_UBIR</span></h3><div style="--en-callout:true;"><div>IMX6ULL波特率计算公式：</div></div><img src="09 IMX6ULL裸机开发：UART串口简介及寄存器介绍_files/Image [14].png" type="image/png" data-filename="Image.png" style="--en-uploadstate:uploaded;" width="531px"/><div>这个寄存器可以由软件和硬件编写。启用波特率自动检测功能后，硬件在检测完波特率后，可以将OxOOOF值写入UBR。当软件和硬件都尝试在同一周期编写时，硬件具有更高的优先级。</div><p>请注意软件复位会将寄存器重置到其复位值。</p><img src="09 IMX6ULL裸机开发：UART串口简介及寄存器介绍_files/Image [15].png" type="image/png" data-filename="Image.png" style="--en-uploadstate:uploaded;"/><div><span style="color: #FF0000;"><span style="background-color: #f7f8fa;">注意：</span></span></div><div><span style="background-color: #f7f8fa;"> </span>    <span style="background-color: #f7f8fa;">要正确更新波特率，必须先更新UBIR寄存器。如果软件只向一个寄存器写入数据，则BRM将忽略该数据，直到软件向另一个寄存器写入数据。不建议使用字节访问来更新此字段，并且没有定义。</span></div><h3>2.2.9 <span style="background-color: #ffff00;">UART1_UBMR</span></h3><div><br/></div><div style="text-align:center;">同上差不多，查阅芯片手册</div><div style="text-align:center;"><br/></div><div>     用于设置波特率即每秒可传输的位数，后面UART编程会详细讲解。</div><div>基本我们使用的寄存器就这些，其他都是一些功能扩展，想详细了解的可以查看芯片手册的《Chapter 55 Universal Asynchronous Receiver/Transmitter(UART)》</div></span>
</div></body></html> 