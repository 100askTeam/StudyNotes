<html>
<head>
  <title>03 IMX6ULL裸机开发：普适的GPIO引脚操作方法概述</title>
  <basefont face="微软雅黑" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="YXBJ Windows/605138 (zh-CN, DDL); Windows/10.0.0 (Win64); EDAMVersion=V2;"/>
  <meta name="content-class" content="yinxiang.superNote"/>
  <style>
    body, td {
      font-family: 微软雅黑;
      font-size: 12pt;
    }
  </style>
</head>
<body>
<a name="715"/>
<h1>03 IMX6ULL裸机开发：普适的GPIO引脚操作方法概述</h1>
<div>
<table bgcolor="#D4DDE5" border="0">
<tr><td><b>创建时间：</b></td><td><i>2021/12/28 9:19</i></td></tr>
<tr><td><b>更新时间：</b></td><td><i>2022/2/17 18:21</i></td></tr>
<tr><td><b>作者：</b></td><td><i>gi51wa2j</i></td></tr>
<tr><td><b>标签：</b></td><td><i>100ask_IMX6ULL_v11, bingo, 正文</i></td></tr>
</table>
</div>
<br/>

<div><span><h1>一、概念介绍</h1><div>GPIO: General-purpose input/output，通用的输入输出口。</div><h2><b>1.1 GPIO模块一般结构</b></h2><ul><li><p><span style="background-color: #ffff00;">有多组GPIO，每组有多个GPIO</span></p></li><li><p><span style="background-color: #ffff00;">使能：电源/时钟</span></p></li><li><p><span style="background-color: #ffff00;">模式(Mode)：引脚可用于GPIO或其他功能</span></p></li><li><p><span style="background-color: #ffff00;">方向：引脚Mode设置为GPIO时，可以继续设置它是输出引脚，还是输入引脚</span></p></li><li><p><span style="background-color: #ffff00;">数值：对于输出引脚，可以设置寄存器让它输出高、低电平</span></p></li></ul><p style="padding-left:40px;"><span style="background-color: #ffff00;">  对于输入引脚，可以读取寄存器得到引脚的当前电平</span></p><h2><b>1.2 GPIO寄存器操作</b></h2><ul><li><p>芯片手册一般有相关章节，用来介绍：power/clock，可以设置对应寄存器使能某个GPIO模块(Module)，有些芯片的的GPIO是没有使能开关的，即它总是使能的</p></li></ul><ul><li><p>一个引脚可以用于GPIO、串口、USB或其他功能，有对应的寄存器来选择引脚的功能</p></li></ul><ul><li><p>对于已经设置为GPIO功能的引脚，有方向寄存器用来设置它的方向：输出、输入</p></li><li><p>对于已经设置为GPIO功能的引脚，有数据寄存器用来写、读引脚电平状态</p></li></ul><h2>1.3 GPIO不同单板操作流程图</h2><div><br/></div><img src="03 IMX6ULL裸机开发：普适的GPIO引脚操作方法概述_files/Image.png" type="image/png" data-filename="Image.png" style="--en-uploadstate:uploaded;"/><h2><span style="background-color: #ffff00;">1.4 GPIO寄存器的2种操作方法：</span></h2><div style="--en-blockquote:true;box-sizing: border-box; padding-left: 19px; padding-top: 6px; padding-bottom: 6px; border-left: 3px solid #b4c0cc; background-position: initial initial; background-repeat: initial initial; margin-top: 6px"><div>本节后文3.1.2重复提及，不过此处更为详细，方便理解</div></div><p>原则：<b>不能影响到其他位</b></p><h3><span style="background-color: #ffff00;"><b>1.4.1 直接读写：读出、修改对应位、写入</b></span></h3><p>要设置bit n：</p><div style="--en-codeblock:true;--en-codeblockLanguage:clike;box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902); background-position: initial initial; background-repeat: initial initial; margin-top: 6px;">val = data_reg;
val = val | (1&lt;&lt;n);
data_reg = val</div><p>要清除bit n：</p><div style="--en-codeblock:true;--en-codeblockLanguage:clike;box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902); background-position: initial initial; background-repeat: initial initial; margin-top: 6px;">val = data_reg;
val = val &amp; ~(1&lt;&lt;n)
data_reg = val;</div><p><b> </b></p><h3><span style="background-color: #ffff00;"><b>1.4.2 set-and-clear protocol：（高效）</b></span></h3><p>set_reg, clr_reg, data_reg 三个寄存器对应的是同一个物理寄存器,</p><p>要设置bit n：set_reg = (1&lt;&lt;n);</p><p>要清除bit n：clr_reg = (1&lt;&lt;n);</p><img src="03 IMX6ULL裸机开发：普适的GPIO引脚操作方法概述_files/第02节_GPIO引脚操作方法概述.tif" type="image/tiff" data-filename="第02节_GPIO引脚操作方法概述.tif"/><div>（视频笔记）</div><h1>二、IMX6ULL的GPIO操作方法</h1><h2><b>2.1 GPIO的其他功能：防抖动、中断、唤醒</b></h2><div>后续章节再介绍</div><h2><b>2.2 IMX6ULL的GPIO操作方法</b></h2><div><span style="background-color: #ffff00;">CCM: Clock Controller Module </span>(时钟控制模块)</div><div><span style="background-color: #ffff00;">IOMUXC : IOMUX Controller</span>，IO复用控制器</div><div><span style="background-color: #ffff00;">GPIO: General-purpose input/output</span>，通用的输入输出口</div><div><br/></div><div><span style="color: #FF0000;">就根据这些常用的寄存器，拿到芯片手册可以直接查找相应的寄存器来设置所需要的GPIO</span></div><h2><b>2.3 IMX6ULL的GPIO模块结构</b></h2><div><b>参考资料</b>：网盘开发板配套资料“<span style="background-color: #ffff00;">06_Datasheet（数据手册）/Core_board/CPU/IMX6ULLRM.pdf</span>”中《Chapter 28: General Purpose Input/Output (GPIO)》。</div><div>有5组GPIO（GPIO1～GPIO5），每组引脚最多有32个，但是可能实际上并没有那么多。</div><div style="padding-left:120px;"><span style="background-color: #ffff00;">GPIO1有32个引脚：</span>GPIO1_IO0~GPIO1_IO31；</div><div style="padding-left:120px;"><span style="background-color: #ffff00;">GPIO2有22个引脚：</span>GPIO2_IO0~GPIO2_IO21；</div><div style="padding-left:120px;"><span style="background-color: #ffff00;">GPIO3有29个引脚：</span>GPIO3_IO0~GPIO3_IO28；</div><div style="padding-left:120px;"><span style="background-color: #ffff00;">GPIO4有29个引脚：</span>GPIO4_IO0~GPIO4_IO28；</div><div style="padding-left:120px;"><span style="background-color: #ffff00;">GPIO5有12个引脚：</span>GPIO5_IO0~GPIO5_IO11；</div><div style="padding-left:40px;"><br/></div><div>GPIO的控制涉及4大模块：CCM、IOMUXC、GPIO模块、本身，框图如下：</div><img src="03 IMX6ULL裸机开发：普适的GPIO引脚操作方法概述_files/Image [1].png" type="image/png" data-filename="Image.png" style="--en-uploadstate:uploaded;" width="608px"/><div>关于上图的使用及相关寄存器的使用，可以看链接：https://blog.csdn.net/u010168781/article/details/77855666</div><h3><b>2.3.1 CCM用于设置是否向GPIO模块提供时钟</b></h3><div><b>参考资料</b>：网盘开发板配套资料“06_Datasheet（数据手册）/Core_board/CPU/IMX6ULLRM.pdf”芯片手册《Chapter 18: Clock Controller Module (CCM)》。</div><img src="03 IMX6ULL裸机开发：普适的GPIO引脚操作方法概述_files/Image [2].png" type="image/png" data-filename="Image.png" style="--en-uploadstate:uploaded;"/><div>在原理图中找到引脚号后，在CCM的寄存器中寻找相应寄存器对其GPIO组进行是时钟使能</div><div style="padding-left:40px;">GPIOx要用CCM_CCGRy寄存器中的2位来决定该组GPIO是否使能。哪组GPIO用哪个CCM_CCGR寄存器来设置，请看下表。</div><table style="--en-fitwindow:false;border-left:1px solid #d9d9d9;border-top:1px solid #d9d9d9;border-collapse:collapse;width:561px;" width="561px"><colgroup><col style="width: 190px;"></col><col style="width: 371px;"></col></colgroup><tbody><tr><td style="--en-typeInfo:{&quot;type&quot;:&quot;text&quot;,&quot;data&quot;:{}};border-right:1px solid #d9d9d9;border-bottom:1px solid #d9d9d9;padding:10px;"><div>GPIO组</div></td><td style="--en-typeInfo:{&quot;type&quot;:&quot;text&quot;,&quot;data&quot;:{}};border-right:1px solid #d9d9d9;border-bottom:1px solid #d9d9d9;padding:10px;"><div>所对应的CCM_CCGR寄存器</div></td></tr><tr><td style="--en-typeInfo:{&quot;type&quot;:&quot;text&quot;,&quot;data&quot;:{}};border-right:1px solid #d9d9d9;border-bottom:1px solid #d9d9d9;padding:10px;"><div>GPIO1</div></td><td style="--en-typeInfo:{&quot;type&quot;:&quot;text&quot;,&quot;data&quot;:{}};border-right:1px solid #d9d9d9;border-bottom:1px solid #d9d9d9;padding:10px;"><div>CCM_CCGR1</div></td></tr><tr><td style="--en-typeInfo:{&quot;type&quot;:&quot;text&quot;,&quot;data&quot;:{}};border-right:1px solid #d9d9d9;border-bottom:1px solid #d9d9d9;padding:10px;"><div>GPIO2</div></td><td style="--en-typeInfo:{&quot;type&quot;:&quot;text&quot;,&quot;data&quot;:{}};border-right:1px solid #d9d9d9;border-bottom:1px solid #d9d9d9;padding:10px;"><div>CCM_CCGR0</div></td></tr><tr><td style="--en-typeInfo:{&quot;type&quot;:&quot;text&quot;,&quot;data&quot;:{}};border-right:1px solid #d9d9d9;border-bottom:1px solid #d9d9d9;padding:10px;"><div>GPIO3</div></td><td style="--en-typeInfo:{&quot;type&quot;:&quot;text&quot;,&quot;data&quot;:{}};border-right:1px solid #d9d9d9;border-bottom:1px solid #d9d9d9;padding:10px;"><div>CCM_CCGR2</div></td></tr><tr><td style="--en-typeInfo:{&quot;type&quot;:&quot;text&quot;,&quot;data&quot;:{}};border-right:1px solid #d9d9d9;border-bottom:1px solid #d9d9d9;padding:10px;"><div>GPIO4</div></td><td style="--en-typeInfo:{&quot;type&quot;:&quot;text&quot;,&quot;data&quot;:{}};border-right:1px solid #d9d9d9;border-bottom:1px solid #d9d9d9;padding:10px;"><div>CCM_CCGR</div></td></tr><tr><td style="--en-typeInfo:{&quot;type&quot;:&quot;text&quot;,&quot;data&quot;:{}};border-right:1px solid #d9d9d9;border-bottom:1px solid #d9d9d9;padding:10px;"><div>GPIO5</div></td><td style="--en-typeInfo:{&quot;type&quot;:&quot;text&quot;,&quot;data&quot;:{}};border-right:1px solid #d9d9d9;border-bottom:1px solid #d9d9d9;padding:10px;"><div>CCM_CCGR1</div></td></tr></tbody></table><div style="padding-left:40px;">CCM_CCGR寄存器中某2位的取值含义如下：</div><img src="03 IMX6ULL裸机开发：普适的GPIO引脚操作方法概述_files/Image [3].png" type="image/png" data-filename="Image.png" style="--en-uploadstate:uploaded;" width="816px"/><div>① 00：该GPIO模块全程被关闭</div><div>② 01：该GPIO模块在CPU run mode情况下是使能的；在WAIT或STOP模式下，关闭</div><div>③ 10：保留</div><div>④ 11：该GPIO模块全程使能</div><div style="padding-left:40px;"><b>GPIO2时钟控制：</b></div><img src="03 IMX6ULL裸机开发：普适的GPIO引脚操作方法概述_files/Image [4].png" type="image/png" data-filename="Image.png" style="--en-uploadstate:uploaded;" width="520px"/><div style="padding-left:40px;"><br/></div><div style="padding-left:40px;"><b>GPIO1、GPIO5时钟控制：</b></div><img src="03 IMX6ULL裸机开发：普适的GPIO引脚操作方法概述_files/Image [5].png" type="image/png" data-filename="Image.png" style="--en-uploadstate:uploaded;" width="475px"/><div style="padding-left:40px;"><b>GPIO3时钟控制：</b></div><img src="03 IMX6ULL裸机开发：普适的GPIO引脚操作方法概述_files/Image [6].png" type="image/png" data-filename="Image.png" style="--en-uploadstate:uploaded;" width="449px"/><div style="padding-left:40px;"><b>GPIO4时钟控制：</b></div><img src="03 IMX6ULL裸机开发：普适的GPIO引脚操作方法概述_files/Image [7].png" type="image/png" data-filename="Image.png" style="--en-uploadstate:uploaded;" width="622px"/><div><br/></div><h3><b>2.3.2 IOMUXC：引脚的模式(Mode、功能)</b></h3><div>参考资料：芯片手册《Chapter 32: IOMUX Controller (IOMUXC)》。</div><img src="03 IMX6ULL裸机开发：普适的GPIO引脚操作方法概述_files/Image [8].png" type="image/png" data-filename="Image.png" style="--en-uploadstate:uploaded;" width="160px"/><div style="padding-left:40px;"><span style="background-color: #ffff00;">对于某个/某组引脚，IOMUXC中有2个寄存器用来设置它：</span></div><div><span style="background-color: #ffff00;"><b>① 选择功能：</b></span></div><div style="padding-left:40px;"> IOMUXC<span style="color: #FF0000;">_SW_MUX</span>_CTL<span style="color: #FF0000;">_PAD_&lt;PADNAME&gt; ：</span><span style="background-color: #ffff00;">Mux pad xxx，选择某个pad的功能</span></div><div style="padding-left:40px;"> IOMUXC_<span style="color: #FF0000;">SW_MUX</span>_CTL<span style="color: #FF0000;">_GRP_&lt;GROUP NAME&gt;</span>：<span style="background-color: #ffff00;">Mux grp xxx，选择某组引脚的功能</span></div><div style="padding-left:40px;"><span style="background-color: #ffff00;">某个引脚，或是某组预设的引脚，都有8个可选的模式(alternate (ALT) MUX_MODE)</span>。</div><img src="03 IMX6ULL裸机开发：普适的GPIO引脚操作方法概述_files/Image [9].png" type="image/png" data-filename="Image.png" style="--en-uploadstate:uploaded;" width="347px"/><div style="padding-left:40px;">比如：</div><img src="03 IMX6ULL裸机开发：普适的GPIO引脚操作方法概述_files/Image [10].png" type="image/png" data-filename="Image.png" style="--en-uploadstate:uploaded;" width="496px"/><div><span style="color: #FF0000;"><b>注意：</b></span>IMX6ULL中存Daisy chain的问题，多个引脚可以同时驱动一个模块，所以还需要再进行一次复用选择。</div><div><span style="background-color: #ffff00;"><b>② 设置上下拉电阻等参数：</b></span></div><div style="padding-left:40px;">IOMUXC_<span style="color: #FF0000;">SW_PAD</span>_CTL_PAD<span style="color: #FF0000;">_&lt;PAD_NAME&gt;</span>：pad pad xxx，设置某个pad的参数</div><div style="padding-left:40px;">IOMUXC_<span style="color: #FF0000;">SW_PAD</span>_CTL_GRP_<span style="color: #FF0000;">&lt;GROUP NAME&gt;</span>：pad grp xxx，设置某组引脚的参数</div><img src="03 IMX6ULL裸机开发：普适的GPIO引脚操作方法概述_files/Image [11].png" type="image/png" data-filename="Image.png" style="--en-uploadstate:uploaded;" width="424px"/><div style="padding-left:40px;"><br/></div><div style="padding-left:40px;">比如：</div><img src="03 IMX6ULL裸机开发：普适的GPIO引脚操作方法概述_files/Image [12].png" type="image/png" data-filename="Image.png" style="--en-uploadstate:uploaded;" width="436px"/><h2><b>2.3 GPIO模块内部</b></h2><div>框图如下： </div><div><br/></div><img src="03 IMX6ULL裸机开发：普适的GPIO引脚操作方法概述_files/Image [13].png" type="image/png" data-filename="Image.png" style="--en-uploadstate:uploaded;" width="590px"/><div style="padding-left:40px;"><br/></div><div style="padding-left:40px;"><span style="background-color: #ffff00;">我们暂时只需要关心3个寄存器：</span></div><h3>2.3.1 GDIR</h3><div><span style="background-color: #ffff00;"><b>① GPIOx_GDIR：设置引脚方向，每位对应一个引脚，1-output，0-input</b></span></div><img src="03 IMX6ULL裸机开发：普适的GPIO引脚操作方法概述_files/Image [14].png" type="image/png" data-filename="Image.png" style="--en-uploadstate:uploaded;" width="667px"/><h3>2.3.2 DR</h3><div><b>②</b><span style="background-color: #ffff00;"><b> GPIOx_DR：设置输出引脚的电平，每位对应一个引脚，1-高电平，0-低电平</b></span></div><img src="03 IMX6ULL裸机开发：普适的GPIO引脚操作方法概述_files/Image [15].png" type="image/png" data-filename="Image.png" style="--en-uploadstate:uploaded;" width="698px"/><h3>2.3.3 PSR</h3><div><b>③ </b><span style="background-color: #ffff00;"><b>GPIOx_PSR：读取引脚的电平，每位对应一个引脚，1-高电平，0-低电平</b></span></div><img src="03 IMX6ULL裸机开发：普适的GPIO引脚操作方法概述_files/Image [16].png" type="image/png" data-filename="Image.png" style="--en-uploadstate:uploaded;" width="675px"/><h1><b>三、怎么编程GPIO</b></h1><h2><span style="background-color: #ffff00;">3.1 读GPIO</span></h2><img src="03 IMX6ULL裸机开发：普适的GPIO引脚操作方法概述_files/Image [17].png" type="image/png" data-filename="Image.png" style="--en-uploadstate:uploaded;" width="589px"/><div style="padding-left:40px;">翻译一下：</div><div style="padding-left:40px;"><span style="background-color: #ffff00;">① 设置CCM_CCGRx寄存器中某位使能对应的GPIO模块 // 默认是使能的，上图省略了</span></div><div style="padding-left:40px;"><span style="background-color: #ffff00;">② 设置IOMUX来选择引脚用于GPIO</span></div><div style="padding-left:40px;"><span style="background-color: #ffff00;">③ 设置GPIOx_GDIR中某位为0，把该引脚设置为输入功能</span></div><div style="padding-left:40px;"><span style="background-color: #ffff00;">④ 读GPIOx_DR或GPIOx_PSR得到某位的值（读GPIOx_DR返回的是GPIOx_PSR的值）</span></div><div><br/></div><h2><span style="background-color: #ffff00;">3.2 写GPIO</span></h2><img src="03 IMX6ULL裸机开发：普适的GPIO引脚操作方法概述_files/Image [18].png" type="image/png" data-filename="Image.png" style="--en-uploadstate:uploaded;" width="596px"/><div style="padding-left:40px;">翻译一下：</div><div style="padding-left:80px;"><span style="background-color: #ffff00;">① 设置CCM_CCGRx寄存器中某位使能对应的GPIO模块 // 默认是使能的，上图省略了</span></div><div style="padding-left:80px;"><span style="background-color: #ffff00;">② 设置IOMUX来选择引脚用于GPIO</span></div><div style="padding-left:80px;"><span style="background-color: #ffff00;">③ 设置GPIOx_GDIR中某位为1，把该引脚设置为输出功能</span></div><div style="padding-left:80px;"><span style="background-color: #ffff00;">④ 写GPIOx_DR某位的值</span></div><div style="padding-left:40px;"><br/></div><div style="padding-left:40px;">     需要注意的是，你可以<span style="background-color: #ffff00;">设置该引脚的loopback功能，这样就可以从GPIOx_PSR中读到引脚的有实电平</span>；你从GPIOx_DR中读回的只是上次设置的值，它并不能反应引脚的真实电平，比如可能因为硬件故障导致该引脚跟地短路了，你通过设置GPIOx_DR让它输出高电平并不会起效果。</div><h2></h2></span>
</div></body></html> 