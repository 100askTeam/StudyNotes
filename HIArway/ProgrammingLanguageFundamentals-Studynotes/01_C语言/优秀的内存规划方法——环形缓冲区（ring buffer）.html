<html>
<head>
  <title>优秀的内存规划方法——环形缓冲区（ring buffer）</title>
  <basefont face="微软雅黑" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="YXBJ Windows/605138 (zh-CN, DDL); Windows/10.0.0 (Win64); EDAMVersion=V2;"/>
  <style>
    body, td {
      font-family: 微软雅黑;
      font-size: 12pt;
    }
  </style>
</head>
<body>
<a name="5122"/>
<h1>优秀的内存规划方法——环形缓冲区（ring buffer）</h1>
<div>
<table bgcolor="#D4DDE5" border="0">
<tr><td><b>创建时间：</b></td><td><i>2022/6/1 17:55</i></td></tr>
<tr><td><b>标签：</b></td><td><i>bingo, C, 正文</i></td></tr>
</table>
</div>
<br/>

<div><span>
  <div style="--en-clipped-content:article">
<div><br/></div><div style="font-size: 16px; display:block; min-width: 100%; position: relative;"> <div style="outline:0px;box-sizing:inherit;text-size-adjust:100%;font-family:-apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif;-webkit-font-smoothing:antialiased;color:rgba(0, 0, 0, 0.75);font-variant-ligatures:common-ligatures;line-height:1.625;tab-size:4;"><div style="font-weight:normal;min-width:1200px;background:url(https://csdnimg.cn/release/blogv2/dist/pc/themesSkin/skin-thespecialists/images/bg.gif) repeat;outline:0px;box-sizing:inherit;font-size:14px;background-color:rgb(245, 246, 247);font-family:-apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif;-webkit-font-smoothing:antialiased;font-variant-ligatures:common-ligatures;tab-size:4;line-height:1.625;color:rgba(0, 0, 0, 0.75);"><div style="font-weight:normal;outline:0px;box-sizing:inherit;-webkit-box-pack:center;justify-content:center;"><div style="font-weight:normal;outline:0px;box-sizing:border-box;"><span style="box-sizing:inherit;outline:0px;"><div style="font-weight:normal;outline:0px;box-sizing:inherit;background:rgb(255, 255, 255);border-radius:2px;"><div style="box-sizing:inherit;outline:0px;"><div style="font-weight:normal;outline:0px;box-sizing:inherit;overflow-wrap:break-word;"><div style="font-weight:normal;outline:0px;box-sizing:inherit;overflow-wrap:break-word;font-family:-apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif;-webkit-font-smoothing:antialiased;font-variant-ligatures:no-common-ligatures;word-break:break-word;font-size:16px;">
                    <img src="data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' style='display: none%3b' data-evernote-id='2171' class='js-evernote-checked'%3e %3cpath stroke-linecap='round' d='M5%2c0 0%2c2.5 5%2c5z' id='raphael-marker-block' style='-webkit-tap-highlight-color: rgba(0%2c 0%2c 0%2c 0)%3b' data-evernote-id='2172' class='js-evernote-checked'%3e%3c/path%3e %3c/svg%3e" style="outline:0px;overflow-wrap:break-word;box-sizing:border-box;overflow:hidden;display:none;"></img>
                    <p style="outline:0px;padding:0px;overflow-wrap:break-word;box-sizing:border-box;color:rgb(77, 77, 77);line-height:26px;overflow:auto hidden;margin:0px 0px 16px;font-weight:400;font-size:16px;"></p>
<div style="font-weight:normal;outline:0px;overflow-wrap:break-word;box-sizing:border-box;margin:0px 0px 24px;padding:0px;font-size:18px;line-height:24px;">
 <h3 style="font-family:&quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, SimHei, Arial, SimSun;outline:0px;padding:0px;overflow-wrap:break-word;box-sizing:border-box;color:rgb(79, 79, 79);margin:8px 0px 16px;font-weight:600;line-height:28px;font-size:20px;"><a name="t0" style="margin:0px;padding:0px;font-weight:normal;outline:0px;cursor:pointer;background-color:transparent;overflow-wrap:break-word;box-sizing:border-box;text-decoration:none;color:rgb(78, 161, 219);"></a>目录</h3>
 <ul style="font-weight:normal;outline:0px;list-style:none;overflow-wrap:break-word;box-sizing:border-box;font-size:16px;overflow:auto hidden;list-style-type:none;margin:0px 0px 8px;padding:0px;"><li style="font-weight:normal;list-style:none;outline:0px;padding:0px;overflow-wrap:break-word;box-sizing:border-box;margin:8px 0px 0px 24px;list-style-type:none;"><a href="https://blog.csdn.net/qq_28258885/article/details/118108746?ops_request_misc=&amp;request_id=&amp;biz_id=102&amp;utm_term=%E7%8E%AF%E5%BD%A2%E7%BC%93%E5%86%B2%E5%8C%BA%E5%86%99%E6%BB%A1%E5%92%8C%E4%B8%BA%E7%A9%BA&amp;utm_medium=distribute.pc_search_result.none-task-blog-2~all~sobaiduweb~default-0-118108746.142^v9^control,157^v4^control&amp;spm=1018.2226.3001.4187#_2" style="margin:0px;padding:0px;font-weight:normal;outline:0px;cursor:pointer;background-color:transparent;overflow-wrap:break-word;box-sizing:border-box;text-decoration:none;color:rgb(78, 161, 219);" target="_self">什么是环形缓冲区</a></li><li style="font-weight:normal;list-style:none;outline:0px;padding:0px;overflow-wrap:break-word;box-sizing:border-box;margin:8px 0px 0px 24px;list-style-type:none;"><a href="https://blog.csdn.net/qq_28258885/article/details/118108746?ops_request_misc=&amp;request_id=&amp;biz_id=102&amp;utm_term=%E7%8E%AF%E5%BD%A2%E7%BC%93%E5%86%B2%E5%8C%BA%E5%86%99%E6%BB%A1%E5%92%8C%E4%B8%BA%E7%A9%BA&amp;utm_medium=distribute.pc_search_result.none-task-blog-2~all~sobaiduweb~default-0-118108746.142^v9^control,157^v4^control&amp;spm=1018.2226.3001.4187#buffer_12" style="margin:0px;padding:0px;font-weight:normal;outline:0px;cursor:pointer;background-color:transparent;overflow-wrap:break-word;box-sizing:border-box;text-decoration:none;color:rgb(78, 161, 219);" target="_self">使用环形buffer的好处</a></li><li style="font-weight:normal;list-style:none;outline:0px;padding:0px;overflow-wrap:break-word;box-sizing:border-box;margin:8px 0px 0px 24px;list-style-type:none;"><a href="https://blog.csdn.net/qq_28258885/article/details/118108746?ops_request_misc=&amp;request_id=&amp;biz_id=102&amp;utm_term=%E7%8E%AF%E5%BD%A2%E7%BC%93%E5%86%B2%E5%8C%BA%E5%86%99%E6%BB%A1%E5%92%8C%E4%B8%BA%E7%A9%BA&amp;utm_medium=distribute.pc_search_result.none-task-blog-2~all~sobaiduweb~default-0-118108746.142^v9^control,157^v4^control&amp;spm=1018.2226.3001.4187#buffer_20" style="margin:0px;padding:0px;font-weight:normal;outline:0px;cursor:pointer;background-color:transparent;overflow-wrap:break-word;box-sizing:border-box;text-decoration:none;color:rgb(78, 161, 219);" target="_self">环形buffer的使用场景</a></li><li style="font-weight:normal;list-style:none;outline:0px;padding:0px;overflow-wrap:break-word;box-sizing:border-box;margin:8px 0px 0px 24px;list-style-type:none;"><ul style="font-weight:normal;outline:0px;list-style:none;overflow-wrap:break-word;box-sizing:border-box;font-size:16px;overflow:auto hidden;list-style-type:none;margin:0px 0px 8px;padding:0px;padding-left:24px;"><li style="font-weight:normal;list-style:none;outline:0px;padding:0px;overflow-wrap:break-word;box-sizing:border-box;margin:8px 0px 0px 24px;list-style-type:none;"><a href="https://blog.csdn.net/qq_28258885/article/details/118108746?ops_request_misc=&amp;request_id=&amp;biz_id=102&amp;utm_term=%E7%8E%AF%E5%BD%A2%E7%BC%93%E5%86%B2%E5%8C%BA%E5%86%99%E6%BB%A1%E5%92%8C%E4%B8%BA%E7%A9%BA&amp;utm_medium=distribute.pc_search_result.none-task-blog-2~all~sobaiduweb~default-0-118108746.142^v9^control,157^v4^control&amp;spm=1018.2226.3001.4187#_21" style="margin:0px;padding:0px;font-weight:normal;outline:0px;cursor:pointer;background-color:transparent;overflow-wrap:break-word;box-sizing:border-box;text-decoration:none;color:rgb(78, 161, 219);" target="_self">进程间通信</a></li><li style="font-weight:normal;list-style:none;outline:0px;padding:0px;overflow-wrap:break-word;box-sizing:border-box;margin:8px 0px 0px 24px;list-style-type:none;"><a href="https://blog.csdn.net/qq_28258885/article/details/118108746?ops_request_misc=&amp;request_id=&amp;biz_id=102&amp;utm_term=%E7%8E%AF%E5%BD%A2%E7%BC%93%E5%86%B2%E5%8C%BA%E5%86%99%E6%BB%A1%E5%92%8C%E4%B8%BA%E7%A9%BA&amp;utm_medium=distribute.pc_search_result.none-task-blog-2~all~sobaiduweb~default-0-118108746.142^v9^control,157^v4^control&amp;spm=1018.2226.3001.4187#IO_25" style="margin:0px;padding:0px;font-weight:normal;outline:0px;cursor:pointer;background-color:transparent;overflow-wrap:break-word;box-sizing:border-box;text-decoration:none;color:rgb(78, 161, 219);" target="_self">网络IO</a></li></ul>
  </li><li style="font-weight:normal;list-style:none;outline:0px;padding:0px;overflow-wrap:break-word;box-sizing:border-box;margin:8px 0px 0px 24px;list-style-type:none;"><a href="https://blog.csdn.net/qq_28258885/article/details/118108746?ops_request_misc=&amp;request_id=&amp;biz_id=102&amp;utm_term=%E7%8E%AF%E5%BD%A2%E7%BC%93%E5%86%B2%E5%8C%BA%E5%86%99%E6%BB%A1%E5%92%8C%E4%B8%BA%E7%A9%BA&amp;utm_medium=distribute.pc_search_result.none-task-blog-2~all~sobaiduweb~default-0-118108746.142^v9^control,157^v4^control&amp;spm=1018.2226.3001.4187#_29" style="margin:0px;padding:0px;font-weight:normal;outline:0px;cursor:pointer;background-color:transparent;overflow-wrap:break-word;box-sizing:border-box;text-decoration:none;color:rgb(78, 161, 219);" target="_self">区分缓冲区是满或者是空</a></li><li style="font-weight:normal;list-style:none;outline:0px;padding:0px;overflow-wrap:break-word;box-sizing:border-box;margin:8px 0px 0px 24px;list-style-type:none;"><ul style="font-weight:normal;outline:0px;list-style:none;overflow-wrap:break-word;box-sizing:border-box;font-size:16px;overflow:auto hidden;list-style-type:none;margin:0px 0px 8px;padding:0px;padding-left:24px;"><li style="font-weight:normal;list-style:none;outline:0px;padding:0px;overflow-wrap:break-word;box-sizing:border-box;margin:8px 0px 0px 24px;list-style-type:none;"><a href="https://blog.csdn.net/qq_28258885/article/details/118108746?ops_request_misc=&amp;request_id=&amp;biz_id=102&amp;utm_term=%E7%8E%AF%E5%BD%A2%E7%BC%93%E5%86%B2%E5%8C%BA%E5%86%99%E6%BB%A1%E5%92%8C%E4%B8%BA%E7%A9%BA&amp;utm_medium=distribute.pc_search_result.none-task-blog-2~all~sobaiduweb~default-0-118108746.142^v9^control,157^v4^control&amp;spm=1018.2226.3001.4187#_36" style="margin:0px;padding:0px;font-weight:normal;outline:0px;cursor:pointer;background-color:transparent;overflow-wrap:break-word;box-sizing:border-box;text-decoration:none;color:rgb(78, 161, 219);" target="_self">计数</a></li><li style="font-weight:normal;list-style:none;outline:0px;padding:0px;overflow-wrap:break-word;box-sizing:border-box;margin:8px 0px 0px 24px;list-style-type:none;"><a href="https://blog.csdn.net/qq_28258885/article/details/118108746?ops_request_misc=&amp;request_id=&amp;biz_id=102&amp;utm_term=%E7%8E%AF%E5%BD%A2%E7%BC%93%E5%86%B2%E5%8C%BA%E5%86%99%E6%BB%A1%E5%92%8C%E4%B8%BA%E7%A9%BA&amp;utm_medium=distribute.pc_search_result.none-task-blog-2~all~sobaiduweb~default-0-118108746.142^v9^control,157^v4^control&amp;spm=1018.2226.3001.4187#_39" style="margin:0px;padding:0px;font-weight:normal;outline:0px;cursor:pointer;background-color:transparent;overflow-wrap:break-word;box-sizing:border-box;text-decoration:none;color:rgb(78, 161, 219);" target="_self">保持一个存储单元为空</a></li><li style="font-weight:normal;list-style:none;outline:0px;padding:0px;overflow-wrap:break-word;box-sizing:border-box;margin:8px 0px 0px 24px;list-style-type:none;"><a href="https://blog.csdn.net/qq_28258885/article/details/118108746?ops_request_misc=&amp;request_id=&amp;biz_id=102&amp;utm_term=%E7%8E%AF%E5%BD%A2%E7%BC%93%E5%86%B2%E5%8C%BA%E5%86%99%E6%BB%A1%E5%92%8C%E4%B8%BA%E7%A9%BA&amp;utm_medium=distribute.pc_search_result.none-task-blog-2~all~sobaiduweb~default-0-118108746.142^v9^control,157^v4^control&amp;spm=1018.2226.3001.4187#_46" style="margin:0px;padding:0px;font-weight:normal;outline:0px;cursor:pointer;background-color:transparent;overflow-wrap:break-word;box-sizing:border-box;text-decoration:none;color:rgb(78, 161, 219);" target="_self">镜像指示位</a></li></ul>
  </li><li style="font-weight:normal;list-style:none;outline:0px;padding:0px;overflow-wrap:break-word;box-sizing:border-box;margin:8px 0px 0px 24px;list-style-type:none;"><a href="https://blog.csdn.net/qq_28258885/article/details/118108746?ops_request_misc=&amp;request_id=&amp;biz_id=102&amp;utm_term=%E7%8E%AF%E5%BD%A2%E7%BC%93%E5%86%B2%E5%8C%BA%E5%86%99%E6%BB%A1%E5%92%8C%E4%B8%BA%E7%A9%BA&amp;utm_medium=distribute.pc_search_result.none-task-blog-2~all~sobaiduweb~default-0-118108746.142^v9^control,157^v4^control&amp;spm=1018.2226.3001.4187#buffer_56" style="margin:0px;padding:0px;font-weight:normal;outline:0px;cursor:pointer;background-color:transparent;overflow-wrap:break-word;box-sizing:border-box;text-decoration:none;color:rgb(78, 161, 219);" target="_self">buffer满了之后的操作</a></li><li style="font-weight:normal;list-style:none;outline:0px;padding:0px;overflow-wrap:break-word;box-sizing:border-box;margin:8px 0px 0px 24px;list-style-type:none;"><ul style="font-weight:normal;outline:0px;list-style:none;overflow-wrap:break-word;box-sizing:border-box;font-size:16px;overflow:auto hidden;list-style-type:none;margin:0px 0px 8px;padding:0px;padding-left:24px;"><li style="font-weight:normal;list-style:none;outline:0px;padding:0px;overflow-wrap:break-word;box-sizing:border-box;margin:8px 0px 0px 24px;list-style-type:none;"><a href="https://blog.csdn.net/qq_28258885/article/details/118108746?ops_request_misc=&amp;request_id=&amp;biz_id=102&amp;utm_term=%E7%8E%AF%E5%BD%A2%E7%BC%93%E5%86%B2%E5%8C%BA%E5%86%99%E6%BB%A1%E5%92%8C%E4%B8%BA%E7%A9%BA&amp;utm_medium=distribute.pc_search_result.none-task-blog-2~all~sobaiduweb~default-0-118108746.142^v9^control,157^v4^control&amp;spm=1018.2226.3001.4187#_59" style="margin:0px;padding:0px;font-weight:normal;outline:0px;cursor:pointer;background-color:transparent;overflow-wrap:break-word;box-sizing:border-box;text-decoration:none;color:rgb(78, 161, 219);" target="_self">实时流</a></li><li style="font-weight:normal;list-style:none;outline:0px;padding:0px;overflow-wrap:break-word;box-sizing:border-box;margin:8px 0px 0px 24px;list-style-type:none;"><a href="https://blog.csdn.net/qq_28258885/article/details/118108746?ops_request_misc=&amp;request_id=&amp;biz_id=102&amp;utm_term=%E7%8E%AF%E5%BD%A2%E7%BC%93%E5%86%B2%E5%8C%BA%E5%86%99%E6%BB%A1%E5%92%8C%E4%B8%BA%E7%A9%BA&amp;utm_medium=distribute.pc_search_result.none-task-blog-2~all~sobaiduweb~default-0-118108746.142^v9^control,157^v4^control&amp;spm=1018.2226.3001.4187#_61" style="margin:0px;padding:0px;font-weight:normal;outline:0px;cursor:pointer;background-color:transparent;overflow-wrap:break-word;box-sizing:border-box;text-decoration:none;color:rgb(78, 161, 219);" target="_self">存储流</a></li></ul>
 </li></ul>
</div>
<p style="outline:0px;padding:0px;overflow-wrap:break-word;box-sizing:border-box;color:rgb(77, 77, 77);line-height:26px;overflow:auto hidden;margin:0px 0px 16px;font-weight:400;font-size:16px;"></p> 
<h1 style="font-family:&quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, SimHei, Arial, SimSun;outline:0px;padding:0px;overflow-wrap:break-word;box-sizing:border-box;color:rgb(79, 79, 79);margin:8px 0px 16px;font-weight:600;line-height:32px;font-size:24px;"><a name="t1" style="margin:0px;padding:0px;font-weight:normal;outline:0px;cursor:pointer;background-color:transparent;overflow-wrap:break-word;box-sizing:border-box;text-decoration:none;color:rgb(78, 161, 219);"></a><a style="margin:0px;padding:0px;font-weight:normal;outline:0px;cursor:pointer;background-color:transparent;overflow-wrap:break-word;box-sizing:border-box;text-decoration:none;color:rgb(78, 161, 219);"></a>什么是环形缓冲区</h1> 
<p style="outline:0px;padding:0px;overflow-wrap:break-word;box-sizing:border-box;color:rgb(77, 77, 77);line-height:26px;overflow:auto hidden;margin:0px 0px 16px;font-weight:400;font-size:16px;">线性缓冲区<br style="outline:0px;overflow-wrap:break-word;box-sizing:border-box;"/> 初学者一般使用的<a href="https://so.csdn.net/so/search?q=buffer&amp;spm=1001.2101.3001.7020" style="margin:0px;padding:0px;font-weight:normal;outline:0px;cursor:pointer;background-color:transparent;overflow-wrap:break-word;box-sizing:border-box;padding-left:3px;border-radius:3px;margin-right:3px;background:url(https://csdnimg.cn/release/blogv2/dist/pc/css/../img/iconHighlight.svg) right top / 12px 14px no-repeat transparent;box-shadow:none;padding-right:14px;text-decoration:none;color:rgb(252, 85, 49);" target="_blank">buffer</a>是线性的，数据依次排列依次读取，就像流水线。<br style="outline:0px;overflow-wrap:break-word;box-sizing:border-box;"/> 造成的问题就是，处理大量数据时，需要大段<a href="https://so.csdn.net/so/search?q=%E5%86%85%E5%AD%98&amp;spm=1001.2101.3001.7020" style="margin:0px;padding:0px;font-weight:normal;outline:0px;cursor:pointer;background-color:transparent;overflow-wrap:break-word;box-sizing:border-box;padding-left:3px;border-radius:3px;margin-right:3px;background:url(https://csdnimg.cn/release/blogv2/dist/pc/css/../img/iconHighlight.svg) right top / 12px 14px no-repeat transparent;box-shadow:none;padding-right:14px;text-decoration:none;color:rgb(252, 85, 49);" target="_blank">内存</a>，并且需要考虑对内存的管理。频繁的内存分配不但增加系统的开销，更使得内存碎片不断增多，非常不利于程序长期运行。</p> 
<p style="outline:0px;padding:0px;overflow-wrap:break-word;box-sizing:border-box;color:rgb(77, 77, 77);line-height:26px;overflow:auto hidden;margin:0px 0px 16px;font-weight:400;font-size:16px;">环形缓冲区<br style="outline:0px;overflow-wrap:break-word;box-sizing:border-box;"/> 使用一段固定长度的内存，在内存用尽后，剩余未存的数据从这段内存的起始位置开始存放。<br style="outline:0px;overflow-wrap:break-word;box-sizing:border-box;"/> 就像两个人围着一张原型的桌子追逐，一个写，一个读。<br style="outline:0px;overflow-wrap:break-word;box-sizing:border-box;"/> 这样反复使用内存，能使得我们能使用更少的内存块做更多的事情，并且对内存的管理更加方便更加安全。</p> 
<h1 style="font-family:&quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, SimHei, Arial, SimSun;outline:0px;padding:0px;overflow-wrap:break-word;box-sizing:border-box;color:rgb(79, 79, 79);margin:8px 0px 16px;font-weight:600;line-height:32px;font-size:24px;"><a name="t2" style="margin:0px;padding:0px;font-weight:normal;outline:0px;cursor:pointer;background-color:transparent;overflow-wrap:break-word;box-sizing:border-box;text-decoration:none;color:rgb(78, 161, 219);"></a><a style="margin:0px;padding:0px;font-weight:normal;outline:0px;cursor:pointer;background-color:transparent;overflow-wrap:break-word;box-sizing:border-box;text-decoration:none;color:rgb(78, 161, 219);"></a>使用环形buffer的好处</h1> 
<p style="outline:0px;padding:0px;overflow-wrap:break-word;box-sizing:border-box;color:rgb(77, 77, 77);line-height:26px;overflow:auto hidden;margin:0px 0px 16px;font-weight:400;font-size:16px;">使用线性buffer——<br style="outline:0px;overflow-wrap:break-word;box-sizing:border-box;"/> 频繁的内存分配不但增加了系统开销，更使得内存碎片不断增多，非常不利于我们的程序长期稳定运行。</p> 
<p style="outline:0px;padding:0px;overflow-wrap:break-word;box-sizing:border-box;color:rgb(77, 77, 77);line-height:26px;overflow:auto hidden;margin:0px 0px 16px;font-weight:400;font-size:16px;">使用环形buffer——<br style="outline:0px;overflow-wrap:break-word;box-sizing:border-box;"/> 圆形缓冲区（circular buffer），也称作圆形队列（circular queue），循环缓冲区（cyclic buffer），环形缓冲区（ring buffer），是一种用于表示一个固定尺寸、头尾相连的缓冲区的数据结构，适合缓存数据流。<br style="outline:0px;overflow-wrap:break-word;box-sizing:border-box;"/> 　环形缓冲区是一项很好的技术，不用频繁的分配内存，而且在大多数情况下，内存的反复使用也使得我们能用更少的内存块做更多的事并且对内存的管理更加方便更加安全。</p> 
<h1 style="font-family:&quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, SimHei, Arial, SimSun;outline:0px;padding:0px;overflow-wrap:break-word;box-sizing:border-box;color:rgb(79, 79, 79);margin:8px 0px 16px;font-weight:600;line-height:32px;font-size:24px;"><a name="t3" style="margin:0px;padding:0px;font-weight:normal;outline:0px;cursor:pointer;background-color:transparent;overflow-wrap:break-word;box-sizing:border-box;text-decoration:none;color:rgb(78, 161, 219);"></a><a style="margin:0px;padding:0px;font-weight:normal;outline:0px;cursor:pointer;background-color:transparent;overflow-wrap:break-word;box-sizing:border-box;text-decoration:none;color:rgb(78, 161, 219);"></a>环形buffer的使用场景</h1> 
<h2 style="font-family:&quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, SimHei, Arial, SimSun;outline:0px;padding:0px;overflow-wrap:break-word;box-sizing:border-box;color:rgb(79, 79, 79);margin:8px 0px 16px;font-weight:600;line-height:30px;font-size:22px;"><a name="t4" style="margin:0px;padding:0px;font-weight:normal;outline:0px;cursor:pointer;background-color:transparent;overflow-wrap:break-word;box-sizing:border-box;text-decoration:none;color:rgb(78, 161, 219);"></a><a style="margin:0px;padding:0px;font-weight:normal;outline:0px;cursor:pointer;background-color:transparent;overflow-wrap:break-word;box-sizing:border-box;text-decoration:none;color:rgb(78, 161, 219);"></a>进程间通信</h2> 
<p style="outline:0px;padding:0px;overflow-wrap:break-word;box-sizing:border-box;color:rgb(77, 77, 77);line-height:26px;overflow:auto hidden;margin:0px 0px 16px;font-weight:400;font-size:16px;">一般使用的是共享内存。只需要一定长度的共享内存就可以循环传输大量数据进行通信。<br style="outline:0px;overflow-wrap:break-word;box-sizing:border-box;"/> 如果使用链表，就需要涉及到内存释放问题。</p> 
<h2 style="font-family:&quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, SimHei, Arial, SimSun;outline:0px;padding:0px;overflow-wrap:break-word;box-sizing:border-box;color:rgb(79, 79, 79);margin:8px 0px 16px;font-weight:600;line-height:30px;font-size:22px;"><a name="t5" style="margin:0px;padding:0px;font-weight:normal;outline:0px;cursor:pointer;background-color:transparent;overflow-wrap:break-word;box-sizing:border-box;text-decoration:none;color:rgb(78, 161, 219);"></a><a style="margin:0px;padding:0px;font-weight:normal;outline:0px;cursor:pointer;background-color:transparent;overflow-wrap:break-word;box-sizing:border-box;text-decoration:none;color:rgb(78, 161, 219);"></a>网络IO</h2> 
<p style="outline:0px;padding:0px;overflow-wrap:break-word;box-sizing:border-box;color:rgb(77, 77, 77);line-height:26px;overflow:auto hidden;margin:0px 0px 16px;font-weight:400;font-size:16px;">某安霸工程师告诉我，他们的方案是使用<a href="https://so.csdn.net/so/search?q=socket&amp;spm=1001.2101.3001.7020" style="margin:0px;padding:0px;font-weight:normal;outline:0px;cursor:pointer;background-color:transparent;overflow-wrap:break-word;box-sizing:border-box;padding-left:3px;border-radius:3px;margin-right:3px;background:url(https://csdnimg.cn/release/blogv2/dist/pc/css/../img/iconHighlight.svg) right top / 12px 14px no-repeat transparent;box-shadow:none;padding-right:14px;text-decoration:none;color:rgb(252, 85, 49);" target="_blank">socket</a>，原因是共享内存安全性较低。<br style="outline:0px;overflow-wrap:break-word;box-sizing:border-box;"/> 方案是，为每一个链接都准备一个环形缓冲区，用于临时存放接收到的数据，以应付半包及粘包的情况。解包解密后，将数据包再复制到逻辑线程消息队列中。</p> 
<h1 style="font-family:&quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, SimHei, Arial, SimSun;outline:0px;padding:0px;overflow-wrap:break-word;box-sizing:border-box;color:rgb(79, 79, 79);margin:8px 0px 16px;font-weight:600;line-height:32px;font-size:24px;"><a name="t6" style="margin:0px;padding:0px;font-weight:normal;outline:0px;cursor:pointer;background-color:transparent;overflow-wrap:break-word;box-sizing:border-box;text-decoration:none;color:rgb(78, 161, 219);"></a><a style="margin:0px;padding:0px;font-weight:normal;outline:0px;cursor:pointer;background-color:transparent;overflow-wrap:break-word;box-sizing:border-box;text-decoration:none;color:rgb(78, 161, 219);"></a>区分缓冲区是满或者是空</h1> 
<p style="outline:0px;padding:0px;overflow-wrap:break-word;box-sizing:border-box;color:rgb(77, 77, 77);line-height:26px;overflow:auto hidden;margin:0px 0px 16px;font-weight:400;font-size:16px;">使用环形buffer的注意点就是：需要区分缓冲区是满或者是空<br style="outline:0px;overflow-wrap:break-word;box-sizing:border-box;"/> <img src="优秀的内存规划方法——环形缓冲区（ring buffer）_files/20210622161831281.png" type="image/png" data-filename="20210622161831281.png" height="167" style="border:0px;outline:0px;border-style:none;overflow-wrap:break-word;box-sizing:border-box;margin:24px 0px;max-width:100%;cursor:zoom-in;" width="534"/><br style="outline:0px;overflow-wrap:break-word;box-sizing:border-box;"/> 满或空，读写指针会出现在同一位置</p> 
<p style="outline:0px;padding:0px;overflow-wrap:break-word;box-sizing:border-box;color:rgb(77, 77, 77);line-height:26px;overflow:auto hidden;margin:0px 0px 16px;font-weight:400;font-size:16px;">下面介绍三种方法</p> 
<h2 style="font-family:&quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, SimHei, Arial, SimSun;outline:0px;padding:0px;overflow-wrap:break-word;box-sizing:border-box;color:rgb(79, 79, 79);margin:8px 0px 16px;font-weight:600;line-height:30px;font-size:22px;"><a name="t7" style="margin:0px;padding:0px;font-weight:normal;outline:0px;cursor:pointer;background-color:transparent;overflow-wrap:break-word;box-sizing:border-box;text-decoration:none;color:rgb(78, 161, 219);"></a><a style="margin:0px;padding:0px;font-weight:normal;outline:0px;cursor:pointer;background-color:transparent;overflow-wrap:break-word;box-sizing:border-box;text-decoration:none;color:rgb(78, 161, 219);"></a>计数</h2> 
<p style="outline:0px;padding:0px;overflow-wrap:break-word;box-sizing:border-box;color:rgb(77, 77, 77);line-height:26px;overflow:auto hidden;margin:0px 0px 16px;font-weight:400;font-size:16px;">最简单的方法，读写分别计数。</p> 
<h2 style="font-family:&quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, SimHei, Arial, SimSun;outline:0px;padding:0px;overflow-wrap:break-word;box-sizing:border-box;color:rgb(79, 79, 79);margin:8px 0px 16px;font-weight:600;line-height:30px;font-size:22px;"><a name="t8" style="margin:0px;padding:0px;font-weight:normal;outline:0px;cursor:pointer;background-color:transparent;overflow-wrap:break-word;box-sizing:border-box;text-decoration:none;color:rgb(78, 161, 219);"></a><a style="margin:0px;padding:0px;font-weight:normal;outline:0px;cursor:pointer;background-color:transparent;overflow-wrap:break-word;box-sizing:border-box;text-decoration:none;color:rgb(78, 161, 219);"></a>保持一个<a href="https://so.csdn.net/so/search?q=%E5%AD%98%E5%82%A8%E5%8D%95%E5%85%83&amp;spm=1001.2101.3001.7020" style="margin:0px;padding:0px;font-weight:normal;outline:0px;cursor:pointer;background-color:transparent;overflow-wrap:break-word;box-sizing:border-box;padding-left:3px;border-radius:3px;margin-right:3px;background:url(https://csdnimg.cn/release/blogv2/dist/pc/css/../img/iconHighlight.svg) right top / 12px 14px no-repeat transparent;box-shadow:none;padding-right:14px;text-decoration:none;color:rgb(252, 85, 49);" target="_blank">存储单元</a>为空</h2> 
<p style="outline:0px;padding:0px;overflow-wrap:break-word;box-sizing:border-box;color:rgb(77, 77, 77);line-height:26px;overflow:auto hidden;margin:0px 0px 16px;font-weight:400;font-size:16px;">缓冲区中总是有一个存储单元保持未使用状态。缓冲区最多存入<code style="outline:0px;overflow-wrap:break-word;box-sizing:border-box;padding:2px 4px;font-family:&quot;Source Code Pro&quot;, &quot;DejaVu Sans Mono&quot;, &quot;Ubuntu Mono&quot;, &quot;Anonymous Pro&quot;, &quot;Droid Sans Mono&quot;, Menlo, Monaco, Consolas, Inconsolata, Courier, monospace, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif;font-size:14px;line-height:22px;color:rgb(199, 37, 78);background-color:rgb(249, 242, 244);border-radius:2px;">（size - 1）</code> 个数据。</p> 
<ul style="font-weight:normal;outline:0px;list-style:none;overflow-wrap:break-word;box-sizing:border-box;font-size:16px;overflow:auto hidden;margin:0px 0px 24px;padding:0px;"><li style="font-weight:normal;list-style:none;outline:0px;padding:0px;overflow-wrap:break-word;box-sizing:border-box;list-style-type:disc;margin:8px 0px 0px 32px;">如果读写指针指向同一位置，则缓冲区为空。</li><li style="font-weight:normal;list-style:none;outline:0px;padding:0px;overflow-wrap:break-word;box-sizing:border-box;list-style-type:disc;margin:8px 0px 0px 32px;">如果写指针位于读指针的相邻后一个位置，则缓冲区为满。</li></ul> 
<p style="outline:0px;padding:0px;overflow-wrap:break-word;box-sizing:border-box;color:rgb(77, 77, 77);line-height:26px;overflow:auto hidden;margin:0px 0px 16px;font-weight:400;font-size:16px;">这种策略的优点是简单、鲁棒（稳定健壮）；缺点是语义上实际可存数据量与缓冲区容量不一致，测试缓冲区是否满需要做取余数计算。</p> 
<h2 style="font-family:&quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, SimHei, Arial, SimSun;outline:0px;padding:0px;overflow-wrap:break-word;box-sizing:border-box;color:rgb(79, 79, 79);margin:8px 0px 16px;font-weight:600;line-height:30px;font-size:22px;"><a name="t9" style="margin:0px;padding:0px;font-weight:normal;outline:0px;cursor:pointer;background-color:transparent;overflow-wrap:break-word;box-sizing:border-box;text-decoration:none;color:rgb(78, 161, 219);"></a><a style="margin:0px;padding:0px;font-weight:normal;outline:0px;cursor:pointer;background-color:transparent;overflow-wrap:break-word;box-sizing:border-box;text-decoration:none;color:rgb(78, 161, 219);"></a>镜像指示位</h2> 
<p style="outline:0px;padding:0px;overflow-wrap:break-word;box-sizing:border-box;color:rgb(77, 77, 77);line-height:26px;overflow:auto hidden;margin:0px 0px 16px;font-weight:400;font-size:16px;">缓冲区的长度如果是n，逻辑地址空间则为0至n-1；那么，规定n至2n-1为镜像逻辑地址空间。<br style="outline:0px;overflow-wrap:break-word;box-sizing:border-box;"/> 本策略规定读写指针的地址空间为0至2n-1，其中低半部分对应于常规的逻辑地址空间，高半部分对应于镜像逻辑地址空间。</p> 
<p style="outline:0px;padding:0px;overflow-wrap:break-word;box-sizing:border-box;color:rgb(77, 77, 77);line-height:26px;overflow:auto hidden;margin:0px 0px 16px;font-weight:400;font-size:16px;">当指针值大于等于2n时，使其折返（wrapped）到ptr-2n。使用一位表示写指针或读指针是否进入了虚拟的镜像存储区：置位表示进入，不置位表示没进入还在基本存储区。<br style="outline:0px;overflow-wrap:break-word;box-sizing:border-box;"/> <img src="优秀的内存规划方法——环形缓冲区（ring buffer）_files/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzI4MjU4ODg1,size_16,color_FFFFFF,t_70" type="image/png" data-filename="watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzI4MjU4ODg1,size_16,color_FFFFFF,t_70" height="240" style="border:0px;outline:0px;border-style:none;overflow-wrap:break-word;box-sizing:border-box;margin:24px 0px;max-width:100%;cursor:zoom-in;" width="962"/><br style="outline:0px;overflow-wrap:break-word;box-sizing:border-box;"/> <strong style="outline:0px;overflow-wrap:break-word;box-sizing:border-box;font-weight:700;">这种方法的逻辑是，如果写指针超出了读指针n位，在普通情况下，读写指针重合，但在这种情况下，写指针在镜像空间的读指针+n位，不和读指针重合</strong></p> 
<p style="outline:0px;padding:0px;overflow-wrap:break-word;box-sizing:border-box;color:rgb(77, 77, 77);line-height:26px;overflow:auto hidden;margin:0px 0px 16px;font-weight:400;font-size:16px;">如果缓冲区长度是2的幂，则本方法可以省略镜像指示位。如果读写指针的值相等，则缓冲区为空；如果读写指针相差n，则缓冲区为满，这可以用条件表达式（写指针 == (读指针 异或 缓冲区长度)）来判断。</p> 
<h1 style="font-family:&quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, SimHei, Arial, SimSun;outline:0px;padding:0px;overflow-wrap:break-word;box-sizing:border-box;color:rgb(79, 79, 79);margin:8px 0px 16px;font-weight:600;line-height:32px;font-size:24px;"><a name="t10" style="margin:0px;padding:0px;font-weight:normal;outline:0px;cursor:pointer;background-color:transparent;overflow-wrap:break-word;box-sizing:border-box;text-decoration:none;color:rgb(78, 161, 219);"></a><a style="margin:0px;padding:0px;font-weight:normal;outline:0px;cursor:pointer;background-color:transparent;overflow-wrap:break-word;box-sizing:border-box;text-decoration:none;color:rgb(78, 161, 219);"></a>buffer满了之后的操作</h1> 
<p style="outline:0px;padding:0px;overflow-wrap:break-word;box-sizing:border-box;color:rgb(77, 77, 77);line-height:26px;overflow:auto hidden;margin:0px 0px 16px;font-weight:400;font-size:16px;">介绍两种在音视频方向的操作</p> 
<h2 style="font-family:&quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, SimHei, Arial, SimSun;outline:0px;padding:0px;overflow-wrap:break-word;box-sizing:border-box;color:rgb(79, 79, 79);margin:8px 0px 16px;font-weight:600;line-height:30px;font-size:22px;"><a name="t11" style="margin:0px;padding:0px;font-weight:normal;outline:0px;cursor:pointer;background-color:transparent;overflow-wrap:break-word;box-sizing:border-box;text-decoration:none;color:rgb(78, 161, 219);"></a><a style="margin:0px;padding:0px;font-weight:normal;outline:0px;cursor:pointer;background-color:transparent;overflow-wrap:break-word;box-sizing:border-box;text-decoration:none;color:rgb(78, 161, 219);"></a>实时流</h2> 
<p style="outline:0px;padding:0px;overflow-wrap:break-word;box-sizing:border-box;color:rgb(77, 77, 77);line-height:26px;overflow:auto hidden;margin:0px 0px 16px;font-weight:400;font-size:16px;">这种方案优先保证实时性。如果buffer满了，优先丢弃老的数据，让新数据存进来</p> 
<h2 style="font-family:&quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, SimHei, Arial, SimSun;outline:0px;padding:0px;overflow-wrap:break-word;box-sizing:border-box;color:rgb(79, 79, 79);margin:8px 0px 16px;font-weight:600;line-height:30px;font-size:22px;"><a name="t12" style="margin:0px;padding:0px;font-weight:normal;outline:0px;cursor:pointer;background-color:transparent;overflow-wrap:break-word;box-sizing:border-box;text-decoration:none;color:rgb(78, 161, 219);"></a><a style="margin:0px;padding:0px;font-weight:normal;outline:0px;cursor:pointer;background-color:transparent;overflow-wrap:break-word;box-sizing:border-box;text-decoration:none;color:rgb(78, 161, 219);"></a>存储流</h2> 
<p style="outline:0px;padding:0px;overflow-wrap:break-word;box-sizing:border-box;color:rgb(77, 77, 77);line-height:26px;overflow:auto hidden;margin:0px 0px 16px;font-weight:400;font-size:16px;">这种方案优先保证稳定性。如果buffer满了，舍弃最新的数据，等待老的流处理完再进新的流进行处理</p>
                </div></div></div></div></span></div></div></div></div></div>
</div>
</span>
</div></body></html> 