<html>
<head>
  <title>【1】08业务系统_需求和思路</title>
  <basefont face="微软雅黑" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="YXBJ Windows/605138 (zh-CN, DDL); Windows/10.0.0 (Win64); EDAMVersion=V2;"/>
  <meta name="content-class" content="yinxiang.superNote"/>
  <style>
    body, td {
      font-family: 微软雅黑;
      font-size: 12pt;
    }
  </style>
</head>
<body>
<a name="3575"/>
<h1>【1】08业务系统_需求和思路</h1>
<div>
<table bgcolor="#D4DDE5" border="0">
<tr><td><b>创建时间：</b></td><td><i>2022/3/1 16:19</i></td></tr>
<tr><td><b>更新时间：</b></td><td><i>2022/5/5 14:07</i></td></tr>
<tr><td><b>作者：</b></td><td><i>gi51wa2j</i></td></tr>
<tr><td><b>标签：</b></td><td><i>bingo, RTOS训练营, 基于HAL的智能家居, 正文</i></td></tr>
</table>
</div>
<br/>

<div><span><h1>1.业务系统_需求和思路</h1><h2>1.1 业务需求</h2><img src="【1】08业务系统_需求和思路_files/01_hardware_block.png" type="image/png" data-filename="01_hardware_block.png" style="--en-uploadstate:uploaded;"/><p style="text-align:start;"><br/></p><h3>1.1.1 使用按键控制LED</h3><ul><li><p>K1控制红灯：松开后改变LED状态</p></li><li><p>K2控制绿灯：松开后改变LED状态</p></li></ul><h3>1.1.2 通过网络控制LED、风扇</h3><p style="text-align:start;">PC或者微信小程序可以给板子发送网络数据，控制板上设备。</p><ul><li><p>控制灯：</p></li><ul><li><p>dev可设为： lamp1、lamp2、lamp3</p></li><li><p>命令如下</p></li></ul></ul><p><br/></p><table style="--en-fitwindow:false;border-left:1px solid #d9d9d9;border-top:1px solid #d9d9d9;border-collapse:collapse;width:380px;" width="380px"><colgroup><col style="width: 190px;"></col><col style="width: 190px;"></col></colgroup><tbody><tr><th style="--en-typeInfo:{&quot;type&quot;:&quot;text&quot;,&quot;data&quot;:{}};border-right:1px solid #d9d9d9;border-bottom:1px solid #d9d9d9;padding:10px;"><div><span style="font-weight: bold;">状态</span></div></th><th style="--en-typeInfo:{&quot;type&quot;:&quot;text&quot;,&quot;data&quot;:{}};border-right:1px solid #d9d9d9;border-bottom:1px solid #d9d9d9;padding:10px;"><div><span style="font-weight: bold;">命令</span></div></th></tr><tr><td style="--en-typeInfo:{&quot;type&quot;:&quot;text&quot;,&quot;data&quot;:{}};border-right:1px solid #d9d9d9;border-bottom:1px solid #d9d9d9;padding:10px;"><div>开</div></td><td style="--en-typeInfo:{&quot;type&quot;:&quot;text&quot;,&quot;data&quot;:{}};border-right:1px solid #d9d9d9;border-bottom:1px solid #d9d9d9;padding:10px;"><div>{&quot;dev&quot;:&quot;lamp1&quot;,&quot;status&quot;:&quot;1&quot;}</div></td></tr><tr><td style="--en-typeInfo:{&quot;type&quot;:&quot;text&quot;,&quot;data&quot;:{}};border-right:1px solid #d9d9d9;border-bottom:1px solid #d9d9d9;padding:10px;"><div>关</div></td><td style="--en-typeInfo:{&quot;type&quot;:&quot;text&quot;,&quot;data&quot;:{}};border-right:1px solid #d9d9d9;border-bottom:1px solid #d9d9d9;padding:10px;"><div>{&quot;dev&quot;:&quot;lamp1&quot;,&quot;status&quot;:&quot;0&quot;}</div></td></tr><tr><td style="--en-typeInfo:{&quot;type&quot;:&quot;text&quot;,&quot;data&quot;:{}};border-right:1px solid #d9d9d9;border-bottom:1px solid #d9d9d9;padding:10px;"><div>反转</div></td><td style="--en-typeInfo:{&quot;type&quot;:&quot;text&quot;,&quot;data&quot;:{}};border-right:1px solid #d9d9d9;border-bottom:1px solid #d9d9d9;padding:10px;"><div>{&quot;dev&quot;:&quot;lamp1&quot;,&quot;status&quot;:&quot;2&quot;}</div></td></tr></tbody></table><p><br/></p><ul><li><p>控制风扇</p></li></ul><p><br/></p><table style="--en-fitwindow:false;border-left:1px solid #d9d9d9;border-top:1px solid #d9d9d9;border-collapse:collapse;width:742px;" width="742px"><colgroup><col style="width: 190px;"></col><col style="width: 552px;"></col></colgroup><tbody><tr><th style="--en-typeInfo:{&quot;type&quot;:&quot;text&quot;,&quot;data&quot;:{}};border-right:1px solid #d9d9d9;border-bottom:1px solid #d9d9d9;padding:10px;"><div><span style="font-weight: bold;">状态</span></div></th><th style="--en-typeInfo:{&quot;type&quot;:&quot;text&quot;,&quot;data&quot;:{}};border-right:1px solid #d9d9d9;border-bottom:1px solid #d9d9d9;padding:10px;"><div><span style="font-weight: bold;">命令</span></div></th></tr><tr><td style="--en-typeInfo:{&quot;type&quot;:&quot;text&quot;,&quot;data&quot;:{}};border-right:1px solid #d9d9d9;border-bottom:1px solid #d9d9d9;padding:10px;"><div>顺时针旋转</div></td><td style="--en-typeInfo:{&quot;type&quot;:&quot;text&quot;,&quot;data&quot;:{}};border-right:1px solid #d9d9d9;border-bottom:1px solid #d9d9d9;padding:10px;"><div>{&quot;dev&quot;:&quot;fan&quot;,&quot;status&quot;:&quot;1&quot;}</div></td></tr><tr><td style="--en-typeInfo:{&quot;type&quot;:&quot;text&quot;,&quot;data&quot;:{}};border-right:1px solid #d9d9d9;border-bottom:1px solid #d9d9d9;padding:10px;"><div>逆时针旋转</div></td><td style="--en-typeInfo:{&quot;type&quot;:&quot;text&quot;,&quot;data&quot;:{}};border-right:1px solid #d9d9d9;border-bottom:1px solid #d9d9d9;padding:10px;"><div>{&quot;dev&quot;:&quot;fan&quot;,&quot;status&quot;:&quot;-1&quot;}</div></td></tr><tr><td style="--en-typeInfo:{&quot;type&quot;:&quot;text&quot;,&quot;data&quot;:{}};border-right:1px solid #d9d9d9;border-bottom:1px solid #d9d9d9;padding:10px;"><div>停止</div></td><td style="--en-typeInfo:{&quot;type&quot;:&quot;text&quot;,&quot;data&quot;:{}};border-right:1px solid #d9d9d9;border-bottom:1px solid #d9d9d9;padding:10px;"><div>{&quot;dev&quot;:&quot;fan&quot;,&quot;status&quot;:&quot;0&quot;}</div></td></tr></tbody></table><p><br/></p><p style="text-align:start;"><br/></p><ul><li><p>离家&amp;回家模式</p></li><ul><li><p>离家：把3个LED、1个风扇都关闭</p></li><li><p>回家：把3个LED、1个风扇都打开</p></li></ul></ul><table style="--en-fitwindow:false;border-left:1px solid #d9d9d9;border-top:1px solid #d9d9d9;border-collapse:collapse;width:744px;" width="744px"><colgroup><col style="width: 190px;"></col><col style="width: 554px;"></col></colgroup><tbody><tr><th style="--en-typeInfo:{&quot;type&quot;:&quot;text&quot;,&quot;data&quot;:{}};border-right:1px solid #d9d9d9;border-bottom:1px solid #d9d9d9;padding:10px;"><div>状态</div></th><th style="--en-typeInfo:{&quot;type&quot;:&quot;text&quot;,&quot;data&quot;:{}};border-right:1px solid #d9d9d9;border-bottom:1px solid #d9d9d9;padding:10px;"><div>命令</div></th></tr><tr><td style="--en-typeInfo:{&quot;type&quot;:&quot;text&quot;,&quot;data&quot;:{}};border-right:1px solid #d9d9d9;border-bottom:1px solid #d9d9d9;padding:10px;"><div>回家</div></td><td style="--en-typeInfo:{&quot;type&quot;:&quot;text&quot;,&quot;data&quot;:{}};border-right:1px solid #d9d9d9;border-bottom:1px solid #d9d9d9;padding:10px;"><div>{&quot;dev&quot;:&quot;home&quot;,&quot;status&quot;:&quot;1&quot;}</div></td></tr><tr><td style="--en-typeInfo:{&quot;type&quot;:&quot;text&quot;,&quot;data&quot;:{}};border-right:1px solid #d9d9d9;border-bottom:1px solid #d9d9d9;padding:10px;"><div>离家</div></td><td style="--en-typeInfo:{&quot;type&quot;:&quot;text&quot;,&quot;data&quot;:{}};border-right:1px solid #d9d9d9;border-bottom:1px solid #d9d9d9;padding:10px;"><div>{&quot;dev&quot;:&quot;home&quot;,&quot;status&quot;:&quot;0&quot;}</div></td></tr></tbody></table><p style="text-align:start;"><br/></p><h2>1.2 设计思路</h2><ul><li><p>底层由按键、网卡发出InputEvent</p></li><li><p>最上层用来控制设备</p></li><ul><li><p>根据底层发来的参数控制设备</p></li><li><p>应该屏蔽底层设备细节及它发来的数据：我关心底下的是按键、遥控器还是网络数据，告诉我做什么就可以</p></li><li><p>使用统一的参数：使用Json格式的参数，比如：</p><div style="padding-left:40px;"><code style="-en-code: true">{&quot;dev&quot;:&quot;lamp1&quot;,&quot;status&quot;:&quot;1&quot;}</code></div></li><li><p>网络数据也是使用Json格式的数据</p></li></ul><li><p><b>由于不想由于底层设备的添加而更改最上层程序的控制逻辑，就需要对中间数据进行处理转换为统一的参数，然后使用统一的参数在最上层的控制逻辑程序中进行处理。</b></p></li><li><p>因此需要中间层：把各类InputEvent转换为<b>Json格式的参数</b></p></li></ul><p><br/></p><img src="【1】08业务系统_需求和思路_files/29_business_layer.png" type="image/png" data-filename="29_business_layer.png" style="--en-uploadstate:uploaded;"/><p><br/></p><p style="text-align:start;"><br/></p><h2>1.3 附录: Json格式</h2><p style="text-align:start;"><b>JSON是以“名称 : 值”对的方式存储数据，名称和值之间是以冒号间隔：</b></p><div style="--en-codeblock:true;--en-codeblockLanguage:clike;box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902); background-position: initial initial; background-repeat: initial initial; margin-top: 6px;">&quot;Name&quot;:&quot;weidongshan&quot;</div><div><br/></div><p style="text-align:start;">JSON数据由花括号括起来，可以包含多个“名称：值”对，<b>以逗号隔开</b>：</p><div style="--en-codeblock:true;--en-codeblockLanguage:clike;box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902); background-position: initial initial; background-repeat: initial initial; margin-top: 6px;">{&quot;Name&quot;:&quot;weidongshan&quot;,&quot;Sex&quot;:&quot;Male&quot;,&quot;Age&quot;:&quot;40&quot;}</div><div><br/></div><p style="text-align:start;"><br/></p><h1>2.业务系统_编写代码</h1><p style="text-align:start;">本节源码：在GIT仓库中</p><div style="--en-codeblock:true;--en-codeblockLanguage:clike;box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902); background-position: initial initial; background-repeat: initial initial; margin-top: 6px;">rtos_doc_source\RTOS培训资料\
	01_项目1_基于HAL库实现智能家居\
		05_项目1_基于HAL库的智能家居\1_项目源码\			
			10_27_smarthome_not_tested</div><h2>2.1 程序层次</h2><img src="【1】08业务系统_需求和思路_files/29_business_layer [1].png" type="image/png" data-filename="29_business_layer.png" style="--en-uploadstate:uploaded;"/><p style="text-align:start;"><br/></p><h2>2.2 编写message.c</h2><p style="text-align:start;">把InputEvent转换为Json格式的参数。</p><p style="text-align:start;"><br/></p><h2>2.3 编写smarthome.c</h2><img src="【1】08业务系统_需求和思路_files/02_software_block.png" type="image/png" data-filename="02_software_block.png" style="--en-uploadstate:uploaded;"/><ul><li><p>初始化各类设备</p></li><li><p>连接WIFI</p></li><li><p>在OLED上显示IP、端口</p></li><li><p>读取InputEvent</p></li><li><p>转换为Json格式的参数</p></li><li><p>控制设备</p></li></ul><p style="text-align:start;"><br/></p><h1>3.业务系统_测试</h1><p style="text-align:start;">本节源码：在GIT仓库中</p><div style="--en-codeblock:true;--en-codeblockLanguage:clike;box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902); background-position: initial initial; background-repeat: initial initial; margin-top: 6px;">rtos_doc_source\RTOS培训资料\
	01_项目1_基于HAL库实现智能家居\
		05_项目1_基于HAL库的智能家居\1_项目源码\			
			10_27_smarthome_not_tested
			10_28_smarthome_ok</div><h2>3.1 修改的地方</h2><p style="text-align:start;">使用&quot;Beyond Compare&quot;比较工具比较这2个程序：10_27_smarthome_not_tested和10_28_smarthome_ok。</p><p style="text-align:start;">修改了这些地方：</p><ul><li><p>使用定时器消除按键抖动</p></li></ul><div style="--en-codeblock:true;--en-codeblockLanguage:clike;box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902); background-position: initial initial; background-repeat: initial initial; margin-top: 6px;">1. 移植源码: 10_6_input_unittest_debouncing
2. 涉及文件:
		Core\Src\stm32f1xx_it.c
		ModuleDrivers\driver_key.c
		smartdevice\input\gpio_key.c</div><ul><li><p>增加风扇设备</p></li></ul><div style="--en-codeblock:true;--en-codeblockLanguage:clike;box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902); background-position: initial initial; background-repeat: initial initial; margin-top: 6px;">1. 移植源码: 10_12_device_fan
2. 涉及文件:
		smartdevice\device\fan_device.c
		smartdevice\kal\kal_fan_device.c
		smartdevice\cal\cal_fan_device.c
		ModuleDrivers\driver_fan.c</div><ul><li><p>修改LED设备，增加反转状态的功能</p></li></ul><div style="--en-codeblock:true;--en-codeblockLanguage:clike;box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902); background-position: initial initial; background-repeat: initial initial; margin-top: 6px;">1. 涉及文件:
		smartdevice\device\led_device.h
		smartdevice\device\led_device.c
		ModuleDrivers\driver_led.c</div><ul><li><p>输入系统扩大缓冲区: 网络数据比较大</p></li></ul><div style="--en-codeblock:true;--en-codeblockLanguage:clike;box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902); background-position: initial initial; background-repeat: initial initial; margin-top: 6px;">文件：smartdevice\input\input_system.h
修改：把INTPU_BUF_LEN从20改为了50</div><ul><li><p>修改文本系统的BUG</p></li></ul><div style="--en-codeblock:true;--en-codeblockLanguage:clike;box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902); background-position: initial initial; background-repeat: initial initial; margin-top: 6px;">1.现象：所显示的文字中间有缺失
2.涉及文件：smartdevice\text\show_text.c</div><ul><li><p>在头文件里把WIFI热点信息用宏表示</p></li></ul><div style="--en-codeblock:true;--en-codeblockLanguage:clike;box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902); background-position: initial initial; background-repeat: initial initial; margin-top: 6px;">涉及文件：smartdevice\smarthome\smarthome.h</div><ul><li><p>修改编译错误：编译、修改反复进行</p></li></ul><p style="text-align:start;"><br/></p><h2>3.2 上机实验</h2><h3>3.2.1 确定WIFI热点的名称、密码</h3><p style="text-align:start;">去修改smartdevice\smarthome\smarthome.h，比如：</p><div style="--en-codeblock:true;--en-codeblockLanguage:clike;box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902); background-position: initial initial; background-repeat: initial initial; margin-top: 6px;">/* 你做实验时需要修改这2项: WIFI热点的名称和密码 */
#define SSID        &quot;Programmers&quot;
#define PASSWORD    &quot;100asktech&quot;</div><p style="text-align:start;"><br/></p><h3>3.2.2 启动开发板</h3><p style="text-align:start;">观察OLED屏幕信息，确定IP、Port。</p><p style="text-align:start;"><br/></p><h3>3.2.3 启动微信小程序</h3><ul><li><p>使用微信小程序：搜&quot;百问网嵌入式物联网&quot;</p></li><li><p>使用微信小程序：扫码 </p></li></ul><img src="【1】08业务系统_需求和思路_files/28_wechat_little_prgram.png" type="image/png" data-filename="28_wechat_little_prgram.png" style="--en-uploadstate:uploaded;"/><h3>3.2.4 在PC上操作</h3><p style="text-align:start;">除了微信小程序，</p><p style="text-align:start;">还可以在PC上使用sscom5.13.1给板子发送信息，一样可以控制设备。</p><ul><li><p>控制灯：</p></li><ul><li><p>dev可设为： lamp1、lamp2、lamp3</p></li><li><p>命令如下</p></li></ul></ul><p><br/></p><table style="--en-fitwindow:false;border-left:1px solid #d9d9d9;border-top:1px solid #d9d9d9;border-collapse:collapse;width:380px;" width="380px"><colgroup><col style="width: 190px;"></col><col style="width: 190px;"></col></colgroup><tbody><tr><th style="--en-typeInfo:{&quot;type&quot;:&quot;text&quot;,&quot;data&quot;:{}};border-right:1px solid #d9d9d9;border-bottom:1px solid #d9d9d9;padding:10px;"><div><span style="font-weight: bold;">状态</span></div></th><th style="--en-typeInfo:{&quot;type&quot;:&quot;text&quot;,&quot;data&quot;:{}};border-right:1px solid #d9d9d9;border-bottom:1px solid #d9d9d9;padding:10px;"><div><span style="font-weight: bold;">命令</span></div></th></tr><tr><td style="--en-typeInfo:{&quot;type&quot;:&quot;text&quot;,&quot;data&quot;:{}};border-right:1px solid #d9d9d9;border-bottom:1px solid #d9d9d9;padding:10px;"><div>开</div></td><td style="--en-typeInfo:{&quot;type&quot;:&quot;text&quot;,&quot;data&quot;:{}};border-right:1px solid #d9d9d9;border-bottom:1px solid #d9d9d9;padding:10px;"><div>{&quot;dev&quot;:&quot;lamp1&quot;,&quot;status&quot;:&quot;1&quot;}</div></td></tr><tr><td style="--en-typeInfo:{&quot;type&quot;:&quot;text&quot;,&quot;data&quot;:{}};border-right:1px solid #d9d9d9;border-bottom:1px solid #d9d9d9;padding:10px;"><div>关</div></td><td style="--en-typeInfo:{&quot;type&quot;:&quot;text&quot;,&quot;data&quot;:{}};border-right:1px solid #d9d9d9;border-bottom:1px solid #d9d9d9;padding:10px;"><div>{&quot;dev&quot;:&quot;lamp1&quot;,&quot;status&quot;:&quot;0&quot;}</div></td></tr><tr><td style="--en-typeInfo:{&quot;type&quot;:&quot;text&quot;,&quot;data&quot;:{}};border-right:1px solid #d9d9d9;border-bottom:1px solid #d9d9d9;padding:10px;"><div><br/></div></td><td style="--en-typeInfo:{&quot;type&quot;:&quot;text&quot;,&quot;data&quot;:{}};border-right:1px solid #d9d9d9;border-bottom:1px solid #d9d9d9;padding:10px;"><div>{&quot;dev&quot;:&quot;lamp1&quot;,&quot;status&quot;:&quot;2&quot;}</div></td></tr></tbody></table><div><br/></div><ul><li><p>控制风扇</p></li></ul><table style="--en-fitwindow:false;border-left:1px solid #d9d9d9;border-top:1px solid #d9d9d9;border-collapse:collapse;width:380px;" width="380px"><colgroup><col style="width: 190px;"></col><col style="width: 190px;"></col></colgroup><tbody><tr><th style="--en-typeInfo:{&quot;type&quot;:&quot;text&quot;,&quot;data&quot;:{}};border-right:1px solid #d9d9d9;border-bottom:1px solid #d9d9d9;padding:10px;"><div>状态</div></th><th style="--en-typeInfo:{&quot;type&quot;:&quot;text&quot;,&quot;data&quot;:{}};border-right:1px solid #d9d9d9;border-bottom:1px solid #d9d9d9;padding:10px;"><div>命令</div></th></tr><tr><td style="--en-typeInfo:{&quot;type&quot;:&quot;text&quot;,&quot;data&quot;:{}};border-right:1px solid #d9d9d9;border-bottom:1px solid #d9d9d9;padding:10px;"><div>顺时针旋转</div></td><td style="--en-typeInfo:{&quot;type&quot;:&quot;text&quot;,&quot;data&quot;:{}};border-right:1px solid #d9d9d9;border-bottom:1px solid #d9d9d9;padding:10px;"><div>{&quot;dev&quot;:&quot;fan&quot;,&quot;status&quot;:&quot;-1&quot;}</div></td></tr><tr><td style="--en-typeInfo:{&quot;type&quot;:&quot;text&quot;,&quot;data&quot;:{}};border-right:1px solid #d9d9d9;border-bottom:1px solid #d9d9d9;padding:10px;"><div>逆时针旋转</div></td><td style="--en-typeInfo:{&quot;type&quot;:&quot;text&quot;,&quot;data&quot;:{}};border-right:1px solid #d9d9d9;border-bottom:1px solid #d9d9d9;padding:10px;"><div>{&quot;dev&quot;:&quot;fan&quot;,&quot;status&quot;:&quot;1&quot;}</div></td></tr><tr><td style="--en-typeInfo:{&quot;type&quot;:&quot;text&quot;,&quot;data&quot;:{}};border-right:1px solid #d9d9d9;border-bottom:1px solid #d9d9d9;padding:10px;"><div>停止</div></td><td style="--en-typeInfo:{&quot;type&quot;:&quot;text&quot;,&quot;data&quot;:{}};border-right:1px solid #d9d9d9;border-bottom:1px solid #d9d9d9;padding:10px;"><div>{&quot;dev&quot;:&quot;fan&quot;,&quot;status&quot;:&quot;0&quot;}</div></td></tr></tbody></table><div><br/></div><p style="text-align:start;"><br/></p><ul><li><p>离家&amp;回家模式</p></li><ul><li><p>离家：把3个LED、1个风扇都关闭</p></li><li><p>回家：把3个LED、1个风扇都打开</p></li></ul></ul><table style="--en-fitwindow:false;border-left:1px solid #d9d9d9;border-top:1px solid #d9d9d9;border-collapse:collapse;width:380px;" width="380px"><colgroup><col style="width: 190px;"></col><col style="width: 190px;"></col></colgroup><tbody><tr><th style="--en-typeInfo:{&quot;type&quot;:&quot;text&quot;,&quot;data&quot;:{}};border-right:1px solid #d9d9d9;border-bottom:1px solid #d9d9d9;padding:10px;"><div>状态</div></th><th style="--en-typeInfo:{&quot;type&quot;:&quot;text&quot;,&quot;data&quot;:{}};border-right:1px solid #d9d9d9;border-bottom:1px solid #d9d9d9;padding:10px;"><div>命令</div></th></tr><tr><td style="--en-typeInfo:{&quot;type&quot;:&quot;text&quot;,&quot;data&quot;:{}};border-right:1px solid #d9d9d9;border-bottom:1px solid #d9d9d9;padding:10px;"><div>回家</div></td><td style="--en-typeInfo:{&quot;type&quot;:&quot;text&quot;,&quot;data&quot;:{}};border-right:1px solid #d9d9d9;border-bottom:1px solid #d9d9d9;padding:10px;"><div>{&quot;dev&quot;:&quot;home&quot;,&quot;status&quot;:&quot;0&quot;}</div></td></tr><tr><td style="--en-typeInfo:{&quot;type&quot;:&quot;text&quot;,&quot;data&quot;:{}};border-right:1px solid #d9d9d9;border-bottom:1px solid #d9d9d9;padding:10px;"><div>离家</div></td><td style="--en-typeInfo:{&quot;type&quot;:&quot;text&quot;,&quot;data&quot;:{}};border-right:1px solid #d9d9d9;border-bottom:1px solid #d9d9d9;padding:10px;"><div>{&quot;dev&quot;:&quot;home&quot;,&quot;status&quot;:&quot;1&quot;}</div></td></tr></tbody></table><p><br/></p><h1>4. 为什么要引入RTOS</h1><div><span style="font-size: 14px;"><span style="font-family: Open Sans, Clear Sans, Helvetica Neue, Helvetica, Arial, Segoe UI Emoji, sans-serif;"><span style="color: rgb(51, 51, 51);"><span style="font-weight: 400;">我们这个程序写得已经比较漂亮了，但是我来看看他有什么缺点，得必须引入rtos。</span></span></span></span></div><ol><li><div><b>增加一个功能：检测WIFI连接情况，断开就重连</b></div></li><li><div><b>增加一个功能：玩游戏</b></div></li></ol><div><b>这个游戏，有很耗时间的话：前面智能家居的功能就会受到影响。</b></div><div><span style="font-size: 14px;"><span style="font-family: Open Sans, Clear Sans, Helvetica Neue, Helvetica, Arial, Segoe UI Emoji, sans-serif;"><span style="color: rgb(51, 51, 51);"><span style="font-weight: 400;">这就是传统的单片机程序的缺点：</span></span></span></span></div><div style="--en-codeblock:true;--en-codeblockLanguage:clike;box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902); background-position: initial initial; background-repeat: initial initial; margin-top: 6px;">while (1)
{
  A;
  B;
  C;
}
</div><div><span style="font-size: 14px;"><span style="font-family: Open Sans, Clear Sans, Helvetica Neue, Helvetica, Arial, Segoe UI Emoji, sans-serif;"><span style="color: rgb(51, 51, 51);"><span style="font-weight: 400;">ABC互相影响，你得有强大的统筹能力。</span></span></span></span></div><div><span style="font-size: 14px;"><span style="font-family: Open Sans, Clear Sans, Helvetica Neue, Helvetica, Arial, Segoe UI Emoji, sans-serif;"><span style="color: rgb(51, 51, 51);"><span style="font-weight: 400;">使用纯粹裸机,能够实现复杂功能的工程师: 水平真不一般。</span></span></span></span></div><div><span style="font-size: 14px;"><span style="font-family: Open Sans, Clear Sans, Helvetica Neue, Helvetica, Arial, Segoe UI Emoji, sans-serif;"><span style="color: rgb(51, 51, 51);"><span style="font-weight: 400;">上面问题的关键在于: ABC,是按照顺序,依次执行。</span></span></span></span></div><div><span style="font-size: 14px;"><span style="font-family: Open Sans, Clear Sans, Helvetica Neue, Helvetica, Arial, Segoe UI Emoji, sans-serif;"><span style="color: rgb(51, 51, 51);"><span style="font-weight: 400;">如果,我们能够让ABC同时执行,我就不需要去管别人对我的影响。</span></span></span></span></div><div><br/></div><div><span style="color: #FF0000;"><b>没有rtos时, 我们怎么写复杂的程序？实际上我们已经体现出来了：</b></span></div><div><b>使用中断，我们使用中断来处理了按键、处理了网络数据。</b></div><div><b>另外一种常规的做法是：使用中断来修改状态机。</b></div><div><span style="font-size: 14px;"><span style="font-family: Open Sans, Clear Sans, Helvetica Neue, Helvetica, Arial, Segoe UI Emoji, sans-serif;"><span style="color: rgb(51, 51, 51);"><span style="font-weight: 400;">main里面，根据状态机来执行不同的事情。</span></span></span></span></div><div><br/></div><div><span style="font-size: 14px;"><span style="font-family: Open Sans, Clear Sans, Helvetica Neue, Helvetica, Arial, Segoe UI Emoji, sans-serif;"><span style="color: rgb(51, 51, 51);"><span style="font-weight: 400;">没有rtos的时候，我们要去精心协调各个任务。</span></span></span></span></div><div><span style="font-size: 14px;"><span style="font-family: Open Sans, Clear Sans, Helvetica Neue, Helvetica, Arial, Segoe UI Emoji, sans-serif;"><span style="color: rgb(51, 51, 51);"><span style="font-weight: 400;">在rtos里，ABC看起来可以同时运行，实际上他们还是依次运行。</span></span></span></span></div><div><span style="font-size: 14px;"><span style="font-family: Open Sans, Clear Sans, Helvetica Neue, Helvetica, Arial, Segoe UI Emoji, sans-serif;"><span style="color: rgb(51, 51, 51);"><span style="font-weight: 400;">只不过运行的机制是这样：</span></span></span></span></div><div><span style="font-family: var(--monospace);"><span style="color: rgb(0, 0, 0);"><span style="font-weight: 400;">A运行一毫秒</span></span></span></div><div><span style="font-family: var(--monospace);"><span style="color: rgb(0, 0, 0);"><span style="font-weight: 400;">B运行一毫秒</span></span></span></div><div><span style="font-family: var(--monospace);"><span style="color: rgb(0, 0, 0);"><span style="font-weight: 400;">C运行一毫秒</span></span></span></div><div><span style="font-family: var(--monospace);"><span style="color: rgb(0, 0, 0);"><span style="font-weight: 400;">A运行一毫秒</span></span></span></div><div><span style="font-size: 14px;"><span style="font-family: Open Sans, Clear Sans, Helvetica Neue, Helvetica, Arial, Segoe UI Emoji, sans-serif;"><span style="color: rgb(51, 51, 51);"><span style="font-weight: 400;">我们人类很没那么快，感觉他们好像同时运行。</span></span></span></span></div><div><br/></div><div><span style="font-size: 14px;"><span style="font-family: Open Sans, Clear Sans, Helvetica Neue, Helvetica, Arial, Segoe UI Emoji, sans-serif;"><span style="color: rgb(51, 51, 51);"><span style="font-weight: 400;">这就可以解决很多问题:</span></span></span></span></div><div><span style="font-size: 14px;"><span style="font-family: Open Sans, Clear Sans, Helvetica Neue, Helvetica, Arial, Segoe UI Emoji, sans-serif;"><span style="color: rgb(51, 51, 51);"><span style="font-weight: 400;">A: 游戏</span></span></span></span></div><div><span style="font-size: 14px;"><span style="font-family: Open Sans, Clear Sans, Helvetica Neue, Helvetica, Arial, Segoe UI Emoji, sans-serif;"><span style="color: rgb(51, 51, 51);"><span style="font-weight: 400;">B: 智能家居</span></span></span></span></div><div><span style="font-size: 14px;"><span style="font-family: Open Sans, Clear Sans, Helvetica Neue, Helvetica, Arial, Segoe UI Emoji, sans-serif;"><span style="color: rgb(51, 51, 51);"><span style="font-weight: 400;">在同一个单片机上，A、B同时运行，程序反而更容易写出来。</span></span></span></span></div><div><span style="font-size: 14px;"><span style="font-family: Open Sans, Clear Sans, Helvetica Neue, Helvetica, Arial, Segoe UI Emoji, sans-serif;"><span style="color: rgb(51, 51, 51);"><span style="font-weight: 400;">这作为后天课程的引言，后天我们开始讲FreeRTOS快速入门。</span></span></span></span></div><div><br/></div><div><span style="font-size: 14px;"><span style="font-family: Open Sans, Clear Sans, Helvetica Neue, Helvetica, Arial, Segoe UI Emoji, sans-serif;"><span style="color: rgb(51, 51, 51);"><span style="font-weight: 400;">最后，贴一个图，把我们的程序结构，都写清楚了：</span></span></span></span></div><img src="【1】08业务系统_需求和思路_files/kuxqg829001v.png" type="image/png" data-filename="kuxqg829001v.png" style="--en-uploadstate:uploaded;"/><h1>5. 程序改进</h1><img src="【1】08业务系统_需求和思路_files/Image.png" type="image/png" data-filename="Image.png" style="--en-uploadstate:uploaded;"/><div><br/></div></span>
</div></body></html> 